<!DOCTYPE html>
<html lang="lv">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>LOM TV — Latvijas Online Mūzika</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800;900&family=Noto+Sans:wght@400;500;600;700&family=Bowlby+One+SC&family=Russo+One&family=Caveat:wght@400;500;600;700&family=Sigmar+One&family=Gveret+Levin&family=Handjet:wght@400;500;700&display=swap" rel="stylesheet">
<style>
:root{
  /* Retro-Futurism Palette (80s inspired) */
  --neon-purple:#9b4dff;
  --electric-blue:#19d0e8;
  --hot-pink:#ff4cd2;
  --neon-green:#35ed7e;
  --chrome-silver:#c0c0c0;
  --deep-black:#000000;
  --plastic-black:#0a0a0a;
  --pure-white:#ffffff;
  /* CRT Screen */
  --screen-bg:#0a0a0f;
  /* Typography */
  --font-display:'Montserrat',sans-serif;
  --font-main:'Noto Sans',sans-serif;
  --font-mono:'Noto Sans',monospace;
  /* Layout */
  --panel-w:360px;
  /* Glow helpers */
  --purple-glow:rgba(155,77,255,0.6);
  --blue-glow:rgba(25,208,232,0.6);
  --pink-glow:rgba(255,76,210,0.6);
  --green-glow:rgba(53,237,126,0.6);
}
*{margin:0;padding:0;box-sizing:border-box;-webkit-user-select:none;user-select:none}
html,body{width:100%;height:100%;overflow:hidden;font-family:var(--font-main);background:#000000;color:var(--pure-white)}

/* START SCREEN — Sci-Fi Cyberpunk Background */
@keyframes nebulaDrift{0%{transform:translate(0,0) scale(1)}25%{transform:translate(2%,-1%) scale(1.02)}50%{transform:translate(-1%,2%) scale(1)}75%{transform:translate(1%,1%) scale(1.01)}100%{transform:translate(0,0) scale(1)}}
@keyframes gridPulse{0%,100%{opacity:0.04}50%{opacity:0.08}}
@keyframes particleFloat{0%{transform:translateY(100vh) scale(0);opacity:0}10%{opacity:1}90%{opacity:1}100%{transform:translateY(-10vh) scale(1);opacity:0}}
.start-screen{position:fixed;inset:0;z-index:300;overflow:hidden;
  background:#020808;
  display:flex;flex-direction:column;align-items:center;justify-content:center;gap:20px}
/* Nebula clouds layer */
.start-screen::before{content:'';position:absolute;inset:-20%;z-index:0;
  background:
    radial-gradient(ellipse 80% 50% at 25% 15%,rgba(155,77,255,0.2) 0%,transparent 50%),
    radial-gradient(ellipse 60% 60% at 75% 75%,rgba(25,208,232,0.15) 0%,transparent 50%),
    radial-gradient(ellipse 50% 40% at 60% 30%,rgba(255,76,210,0.1) 0%,transparent 45%),
    radial-gradient(ellipse 90% 70% at 40% 60%,rgba(53,237,126,0.06) 0%,transparent 55%),
    radial-gradient(ellipse 100% 100% at 50% 50%,rgba(5,15,15,0.9) 20%,transparent 70%);
  animation:nebulaDrift 20s ease-in-out infinite;pointer-events:none}
/* Grid overlay */
.start-screen::after{content:'';position:absolute;inset:0;z-index:1;pointer-events:none;
  background:
    linear-gradient(rgba(25,208,232,0.03) 1px,transparent 1px) 0 0 / 60px 60px,
    linear-gradient(90deg,rgba(25,208,232,0.03) 1px,transparent 1px) 0 0 / 60px 60px;
  animation:gridPulse 4s ease-in-out infinite}
/* Floating particles */
.start-particles{position:absolute;inset:0;z-index:1;pointer-events:none;overflow:hidden}
.start-particle{position:absolute;width:2px;height:2px;border-radius:50%;background:rgba(25,208,232,0.8);
  box-shadow:0 0 6px rgba(25,208,232,0.6);animation:particleFloat linear infinite}
.start-particle:nth-child(1){left:10%;animation-duration:8s;animation-delay:0s}
.start-particle:nth-child(2){left:25%;animation-duration:12s;animation-delay:2s;width:3px;height:3px;background:rgba(155,77,255,0.7);box-shadow:0 0 8px rgba(155,77,255,0.5)}
.start-particle:nth-child(3){left:40%;animation-duration:10s;animation-delay:4s}
.start-particle:nth-child(4){left:55%;animation-duration:9s;animation-delay:1s;width:3px;height:3px;background:rgba(255,76,210,0.6);box-shadow:0 0 8px rgba(255,76,210,0.4)}
.start-particle:nth-child(5){left:70%;animation-duration:11s;animation-delay:3s}
.start-particle:nth-child(6){left:85%;animation-duration:7s;animation-delay:5s;width:3px;height:3px;background:rgba(155,77,255,0.7);box-shadow:0 0 8px rgba(155,77,255,0.5)}
.start-particle:nth-child(7){left:15%;animation-duration:13s;animation-delay:6s}
.start-particle:nth-child(8){left:50%;animation-duration:8s;animation-delay:2.5s;width:1px;height:1px;background:rgba(53,237,126,0.6);box-shadow:0 0 4px rgba(53,237,126,0.4)}
.start-particle:nth-child(9){left:92%;animation-duration:10s;animation-delay:1.5s}
.start-particle:nth-child(10){left:35%;animation-duration:14s;animation-delay:4.5s;width:2px;height:2px;background:rgba(25,208,232,0.5)}
.start-screen{transition:opacity 0.6s ease}
.start-screen.fade-out{opacity:0;pointer-events:none}
.start-screen.hidden{display:none}
.start-btn{position:relative;z-index:10;margin-top:44px;width:120px;height:120px;border-radius:50%;
  display:flex;align-items:center;justify-content:center;padding-left:8px;
  background:linear-gradient(145deg,rgba(155,77,255,0.2),rgba(20,20,30,0.9));
  border:3px solid rgba(155,77,255,0.6);cursor:pointer;
  box-shadow:0 0 30px rgba(155,77,255,0.35),0 0 60px rgba(155,77,255,0.12),inset 0 0 30px rgba(155,77,255,0.08),0 8px 32px rgba(0,0,0,0.5);
  transition:all .3s ease;animation:startBtnPulse 2.5s ease-in-out infinite}
.start-btn:hover{
  background:linear-gradient(145deg,rgba(155,77,255,0.35),rgba(30,20,50,0.95));
  border-color:rgba(155,77,255,0.9);
  box-shadow:0 0 50px rgba(155,77,255,0.5),0 0 100px rgba(155,77,255,0.2),inset 0 0 40px rgba(155,77,255,0.12),0 8px 32px rgba(0,0,0,0.5);
  transform:scale(1.08)}
.start-btn:active{transform:scale(0.95);box-shadow:0 0 20px rgba(155,77,255,0.4),inset 0 0 20px rgba(155,77,255,0.15)}
.start-btn .play-tri{width:0;height:0;border-style:solid;border-width:28px 0 28px 48px;
  border-color:transparent transparent transparent #fff;
  filter:drop-shadow(0 0 12px rgba(155,77,255,0.8)) drop-shadow(0 0 24px rgba(155,77,255,0.4))}
.start-btn-label{position:absolute;bottom:-36px;left:50%;transform:translateX(-50%);white-space:nowrap;
  font-family:'Handjet',var(--font-main);font-size:15px;letter-spacing:5px;color:rgba(155,77,255,0.6);text-transform:uppercase}
@keyframes startBtnPulse{0%,100%{box-shadow:0 0 30px rgba(155,77,255,0.35),0 0 60px rgba(155,77,255,0.12),inset 0 0 30px rgba(155,77,255,0.08),0 8px 32px rgba(0,0,0,0.5);border-color:rgba(155,77,255,0.6)}50%{box-shadow:0 0 45px rgba(155,77,255,0.5),0 0 90px rgba(155,77,255,0.2),inset 0 0 35px rgba(155,77,255,0.12),0 8px 32px rgba(0,0,0,0.5);border-color:rgba(155,77,255,0.85)}}
/* Konfeti */
.confetti-container{position:fixed;inset:0;z-index:400;pointer-events:none;overflow:hidden}
.confetti{position:absolute;width:10px;height:10px;opacity:0;animation:confettiFall 1.5s ease-out forwards}
@keyframes confettiFall{0%{opacity:1;transform:translateY(0) rotateZ(0deg) scale(1.2)}20%{opacity:1}100%{opacity:0;transform:translateY(80vh) rotateZ(540deg) scale(0.2)}}
@keyframes sphereSpin{0%{transform:rotateX(-210deg) rotateY(0deg) rotateZ(185deg)}100%{transform:rotateX(-210deg) rotateY(360deg) rotateZ(185deg)}}
@keyframes sphereShine{50%,100%{border-color:transparent;box-shadow:0 0 1px 1px transparent,0 0 1px 1px transparent inset;filter:hue-rotate(180deg)}}
@keyframes letterGlow{
  0%,100%{
    filter:drop-shadow(0 0 15px var(--neon-purple)) drop-shadow(0 0 30px rgba(155,77,255,0.4));
    transform:scale(1)
  }
  50%{
    filter:drop-shadow(0 0 25px #b366ff) drop-shadow(0 0 50px rgba(155,77,255,0.6));
    transform:scale(1.02)
  }
}
@keyframes stripeScroll{
  0%{background-position:0 0}
  100%{background-position:0 22px}
}
.logo-container{position:relative;z-index:10;display:flex;flex-direction:column;align-items:center;justify-content:center}
.logo-sub-wrap{display:flex;flex-direction:column;align-items:flex-start;position:relative}
.logo-main{position:relative;display:flex;align-items:center;justify-content:center}
.logo-letter{font-family:'Bowlby One SC',var(--font-display),sans-serif;font-size:200px;font-weight:400;letter-spacing:6px;animation:letterGlow 2.5s ease-in-out infinite, stripeScroll 2.5s linear infinite;text-transform:uppercase;position:relative;z-index:2;display:inline-flex;align-items:center;line-height:0.85;
  /* IBM-style horizontal stripes — animated downward */
  background:repeating-linear-gradient(0deg,
    var(--neon-purple) 0px,var(--neon-purple) 16px,
    transparent 16px,transparent 22px);
  background-size:100% 22px;
  -webkit-background-clip:text;background-clip:text;
  -webkit-text-fill-color:transparent;
  filter:drop-shadow(0 0 15px var(--neon-purple)) drop-shadow(0 0 30px rgba(155,77,255,0.4))}
.logo-L{margin-right:14px;font-family:'Bowlby One SC',sans-serif}
.logo-M{margin-left:14px;font-family:'Sigmar One',sans-serif;font-size:220px}
.logo-letter::before{content:'';position:absolute;inset:-15px;z-index:-1;
  background:repeating-linear-gradient(0deg,rgba(0,0,0,0.15) 0px,rgba(0,0,0,0.15) 1px,transparent 1px,transparent 2px);
  pointer-events:none;border-radius:12px;
  backdrop-filter:blur(2px)}
.logo-o-sphere{display:inline-flex;align-items:center;justify-content:center;width:160px;height:200px;position:relative;margin:0 -4px;flex-shrink:0;perspective:600px}
.logo-o-sphere .logo-sphere{--c:var(--neon-purple);width:160px;height:160px;margin:0;left:10px;top:20px;position:absolute;transform-style:preserve-3d;animation:sphereSpin 10s linear infinite}
.logo-o-sphere .logo-sphere div{--sz:23%;--s:2s;--d:40;--dv:calc(var(--s)/var(--d));--dl:calc(var(--dv)*-1);width:var(--sz);height:var(--sz);position:absolute;border:0.15vmin solid var(--c);border-radius:100%;transform:rotateX(90deg) translateZ(86px);box-shadow:0 0 0.3vmin 0.3vmin var(--c),0 0 0.3vmin 0.3vmin var(--c) inset;animation:sphereShine var(--s) linear var(--dl) infinite;background:transparent;left:50%;top:50%;margin-left:calc(var(--sz)/-2);margin-top:calc(var(--sz)/-2)}
.logo-o-sphere .logo-sphere div:nth-child(2){--sz:40%;--dl:calc(var(--dv)*-2);transform:rotateX(90deg) translateZ(79px)}
.logo-o-sphere .logo-sphere div:nth-child(3){--sz:55%;--dl:calc(var(--dv)*-3);transform:rotateX(90deg) translateZ(72px)}
.logo-o-sphere .logo-sphere div:nth-child(4){--sz:68%;--dl:calc(var(--dv)*-4);transform:rotateX(90deg) translateZ(63px)}
.logo-o-sphere .logo-sphere div:nth-child(5){--sz:78%;--dl:calc(var(--dv)*-5);transform:rotateX(90deg) translateZ(54px)}
.logo-o-sphere .logo-sphere div:nth-child(6){--sz:86%;--dl:calc(var(--dv)*-6);transform:rotateX(90deg) translateZ(45px)}
.logo-o-sphere .logo-sphere div:nth-child(7){--sz:92%;--dl:calc(var(--dv)*-7);transform:rotateX(90deg) translateZ(36px)}
.logo-o-sphere .logo-sphere div:nth-child(8){--sz:96%;--dl:calc(var(--dv)*-8);transform:rotateX(90deg) translateZ(27px)}
.logo-o-sphere .logo-sphere div:nth-child(9){--sz:99%;--dl:calc(var(--dv)*-9);transform:rotateX(90deg) translateZ(18px)}
.logo-o-sphere .logo-sphere div:nth-child(10){--sz:100%;--dl:calc(var(--dv)*-10);transform:rotateX(90deg) translateZ(9px)}
.logo-o-sphere .logo-sphere div:nth-child(11){--sz:100%;--dl:calc(var(--dv)*-11);transform:rotateX(90deg) translateZ(0)}
.logo-o-sphere .logo-sphere div:nth-child(12){--sz:99%;--dl:calc(var(--dv)*-12);transform:rotateX(90deg) translateZ(-9px)}
.logo-o-sphere .logo-sphere div:nth-child(13){--sz:96%;--dl:calc(var(--dv)*-13);transform:rotateX(90deg) translateZ(-18px)}
.logo-o-sphere .logo-sphere div:nth-child(14){--sz:92%;--dl:calc(var(--dv)*-14);transform:rotateX(90deg) translateZ(-27px)}
.logo-o-sphere .logo-sphere div:nth-child(15){--sz:86%;--dl:calc(var(--dv)*-15);transform:rotateX(90deg) translateZ(-36px)}
.logo-o-sphere .logo-sphere div:nth-child(16){--sz:78%;--dl:calc(var(--dv)*-16);transform:rotateX(90deg) translateZ(-45px)}
.logo-o-sphere .logo-sphere div:nth-child(17){--sz:68%;--dl:calc(var(--dv)*-17);transform:rotateX(90deg) translateZ(-54px)}
.logo-o-sphere .logo-sphere div:nth-child(18){--sz:55%;--dl:calc(var(--dv)*-18);transform:rotateX(90deg) translateZ(-63px)}
.logo-o-sphere .logo-sphere div:nth-child(19){--sz:40%;--dl:calc(var(--dv)*-19);transform:rotateX(90deg) translateZ(-72px)}
.logo-o-sphere .logo-sphere div:nth-child(20){--sz:23%;--dl:calc(var(--dv)*-20);transform:rotateX(90deg) translateZ(-79px)}
.logo-o-sphere .logo-sphere div:nth-child(21){--sz:10%;--dl:calc(var(--dv)*-21);transform:rotateX(90deg) translateZ(-86px)}
.logo-tv{font-family:'Gveret Levin',cursive;font-size:110px;font-weight:400;color:var(--electric-blue);letter-spacing:2px;position:relative;top:-30px;margin-left:-60px;z-index:3;
  transform:rotate(-14deg);
  text-shadow:0 0 16px rgba(25,208,232,0.9),0 0 32px rgba(25,208,232,0.5);
  display:inline-block;align-self:flex-start;
  -webkit-text-stroke:2px rgba(25,208,232,0.4)}
.logo-sphere-wrap{position:absolute;inset:-25px;display:flex;align-items:center;justify-content:center;pointer-events:none;perspective:600px}
.logo-sphere{--c:var(--neon-purple);position:absolute;width:160px;height:160px;transform-style:preserve-3d;animation:sphereSpin 10s linear infinite}
.logo-sphere div{--sz:23%;--s:2s;--d:40;--dv:calc(var(--s)/var(--d));--dl:calc(var(--dv)*-1);width:var(--sz);height:var(--sz);position:absolute;border:0.15vmin solid var(--c);border-radius:100%;transform:rotateX(90deg) translateZ(78px);box-shadow:0 0 0.3vmin 0.3vmin var(--c),0 0 0.3vmin 0.3vmin var(--c) inset;animation:sphereShine var(--s) linear var(--dl) infinite;background:transparent;left:50%;top:50%;margin-left:calc(var(--sz)/-2);margin-top:calc(var(--sz)/-2)}
.logo-sphere div:nth-child(2){--sz:40%;--dl:calc(var(--dv)*-2);transform:rotateX(90deg) translateZ(71px)}
.logo-sphere div:nth-child(3){--sz:55%;--dl:calc(var(--dv)*-3);transform:rotateX(90deg) translateZ(64px)}
.logo-sphere div:nth-child(4){--sz:68%;--dl:calc(var(--dv)*-4);transform:rotateX(90deg) translateZ(56px)}
.logo-sphere div:nth-child(5){--sz:78%;--dl:calc(var(--dv)*-5);transform:rotateX(90deg) translateZ(48px)}
.logo-sphere div:nth-child(6){--sz:86%;--dl:calc(var(--dv)*-6);transform:rotateX(90deg) translateZ(40px)}
.logo-sphere div:nth-child(7){--sz:92%;--dl:calc(var(--dv)*-7);transform:rotateX(90deg) translateZ(32px)}
.logo-sphere div:nth-child(8){--sz:96%;--dl:calc(var(--dv)*-8);transform:rotateX(90deg) translateZ(24px)}
.logo-sphere div:nth-child(9){--sz:99%;--dl:calc(var(--dv)*-9);transform:rotateX(90deg) translateZ(16px)}
.logo-sphere div:nth-child(10){--sz:100%;--dl:calc(var(--dv)*-10);transform:rotateX(90deg) translateZ(8px)}
.logo-sphere div:nth-child(11){--sz:100%;--dl:calc(var(--dv)*-11);transform:rotateX(90deg) translateZ(0)}
.logo-sphere div:nth-child(12){--sz:99%;--dl:calc(var(--dv)*-12);transform:rotateX(90deg) translateZ(-8px)}
.logo-sphere div:nth-child(13){--sz:96%;--dl:calc(var(--dv)*-13);transform:rotateX(90deg) translateZ(-16px)}
.logo-sphere div:nth-child(14){--sz:92%;--dl:calc(var(--dv)*-14);transform:rotateX(90deg) translateZ(-24px)}
.logo-sphere div:nth-child(15){--sz:86%;--dl:calc(var(--dv)*-15);transform:rotateX(90deg) translateZ(-32px)}
.logo-sphere div:nth-child(16){--sz:78%;--dl:calc(var(--dv)*-16);transform:rotateX(90deg) translateZ(-40px)}
.logo-sphere div:nth-child(17){--sz:68%;--dl:calc(var(--dv)*-17);transform:rotateX(90deg) translateZ(-48px)}
.logo-sphere div:nth-child(18){--sz:55%;--dl:calc(var(--dv)*-18);transform:rotateX(90deg) translateZ(-56px)}
.logo-sphere div:nth-child(19){--sz:40%;--dl:calc(var(--dv)*-19);transform:rotateX(90deg) translateZ(-64px)}
.logo-sphere div:nth-child(20){--sz:23%;--dl:calc(var(--dv)*-20);transform:rotateX(90deg) translateZ(-71px)}
.logo-sphere div:nth-child(21){--sz:10%;--dl:calc(var(--dv)*-21);transform:rotateX(90deg) translateZ(-78px)}
.lomk-sub{font-family:'Handjet',var(--font-main),sans-serif;font-size:26px;font-weight:700;color:rgba(224,227,255,0.65);letter-spacing:8px;text-transform:uppercase;margin-top:34px;width:100%;text-align:left;padding-left:0;margin-left:10px}
.start-sub{font-family:var(--font-main);font-size:18px;font-weight:400;color:rgba(224,227,255,0.35);letter-spacing:5px;width:auto;text-align:left;margin-top:10px;position:relative;z-index:10;align-self:flex-start;margin-left:20px}
/* old start-btn override removed — round play button styles are above */

/* CALIBRATION (УЭИТ) */
.calib-screen{position:absolute;inset:0;z-index:25;display:none;flex-direction:column;border-radius:inherit}
.calib-screen.show{display:flex}
.calib-bars{flex:1;display:flex}
.calib-bar{flex:1}
.calib-bar:nth-child(1){background:#fff}
.calib-bar:nth-child(2){background:#ff0}
.calib-bar:nth-child(3){background:#0ff}
.calib-bar:nth-child(4){background:#0f0}
.calib-bar:nth-child(5){background:#f0f}
.calib-bar:nth-child(6){background:#f00}
.calib-bar:nth-child(7){background:#00f}
.calib-bar:nth-child(8){background:#000}
.calib-bottom{height:28%;display:flex}
.calib-bottom-bar{flex:1}
.calib-bottom-bar:nth-child(1){background:#00007f}
.calib-bottom-bar:nth-child(2){background:#fff}
.calib-bottom-bar:nth-child(3){background:#7f007f}
.calib-bottom-bar:nth-child(4){background:#000}
.calib-bottom-bar:nth-child(5){background:#131313}
.calib-bottom-bar:nth-child(6){background:#000}
.calib-bottom-bar:nth-child(7){background:#1c1c1c}
.calib-bottom-bar:nth-child(8){background:#000}
.calib-label{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-family:var(--font-mono);font-size:26px;color:rgba(255,255,255,0.75);letter-spacing:8px;background:rgba(0,0,0,0.45);padding:8px 24px}

/* MAIN APP */
#app{position:fixed;inset:12px;display:none}

/* TV CASING — Retro Plastic Shell with unified frame */
.tv-casing{position:absolute;inset:0;overflow:hidden;
  background:
    radial-gradient(ellipse 120% 50% at 50% 0%,rgba(155,77,255,0.08) 0%,transparent 60%),
    linear-gradient(135deg,#0a0a0a 0%,#000000 25%,#0a0a0a 50%,#000000 75%,#0a0a0a 100%);
  background-size:100% 100%,400% 400%;
  animation:plasticSheen 8s ease infinite;
  border-radius:18px;
  border:3px solid;
  border-color:#3a3a3a #1a1a1a #0a0a0a #2a2a2a;
  box-shadow:
    0 0 0 1px rgba(0,0,0,0.8),
    0 0 0 4px #111,
    0 0 0 5px rgba(255,255,255,0.06),
    0 8px 40px rgba(0,0,0,0.9),
    0 2px 20px rgba(155,77,255,0.1),
    inset 0 1px 0 rgba(255,255,255,0.05),
    inset 0 -1px 0 rgba(0,0,0,0.8)}
@keyframes plasticSheen{0%{background-position:0% 0%,0% 50%}50%{background-position:0% 0%,100% 50%}100%{background-position:0% 0%,0% 50%}}
/* Grain texture overlay — monologue.to style */
.tv-casing::after{content:'';position:absolute;inset:0;border-radius:inherit;pointer-events:none;z-index:100;
  opacity:0.18;mix-blend-mode:overlay;
  background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
  background-size:128px 128px}

/* SCREEN AREA — Chrome Bezel */
.tv-screen-area{position:absolute;top:16px;bottom:16px;left:16px;right:calc(var(--panel-w) + 16px);
  background:linear-gradient(145deg,#1a1a1a 0%,#0a0a0a 50%,#1a1a1a 100%);
  border-radius:10px;
  box-shadow:
    inset 0 2px 0 rgba(255,255,255,0.1),
    inset 0 -2px 0 rgba(0,0,0,0.8),
    0 0 60px rgba(155,77,255,0.15),
    0 4px 20px rgba(0,0,0,0.8),
    0 8px 32px rgba(0,0,0,0.9);
  border:3px solid;
  border-color:#2e2e2e #0e0e0e #080808 #222}
.tv-screen{position:absolute;top:13px;bottom:13px;left:13px;right:13px;background:var(--screen-bg);border-radius:3px;overflow:hidden;box-shadow:inset 0 0 0 1px rgba(88,101,242,0.1),inset 5px 5px 18px rgba(0,0,0,0.95),inset -5px -5px 18px rgba(0,0,0,0.95)}
.tv-screen::before{content:'';position:absolute;inset:0;border-radius:inherit;background:radial-gradient(ellipse 52% 22% at 16% 7%,rgba(88,101,242,0.06) 0%,transparent 100%),radial-gradient(ellipse at center,transparent 42%,rgba(0,0,0,0.5) 100%);pointer-events:none;z-index:12}
.tv-screen::after{content:'';position:absolute;inset:0;border-radius:inherit;box-shadow:inset 0 0 65px rgba(0,0,0,0.72);pointer-events:none;z-index:13}
.scanlines{position:absolute;inset:0;z-index:11;pointer-events:none;border-radius:inherit;
  background:
    repeating-linear-gradient(0deg,rgba(0,0,0,0.15) 0px,rgba(0,0,0,0.15) 1px,transparent 1px,transparent 2px),
    repeating-linear-gradient(90deg,rgba(155,77,255,0.01) 0px,transparent 1px,transparent 4px);
  animation:scanlineFlicker 8s linear infinite}
@keyframes scanlineFlicker{0%,100%{opacity:0.8}50%{opacity:0.95}}
.yt-slot{width:100%;height:100%;border:none;position:absolute;inset:0;z-index:1;transition:opacity 2s ease}
.yt-slot.yt-ready{top:-80px;left:-15px;width:calc(100% + 30px);height:calc(100% + 160px);pointer-events:none;transform:scale(1.25)}
.yt-slot.yt-hidden{opacity:0}
.yt-blocker{position:absolute;inset:0;z-index:2;cursor:pointer;background:transparent}
/* Bottom bar to hide YouTube related video thumbnails */
.yt-bottom-hide{position:absolute;bottom:0;left:0;right:0;height:90px;z-index:2;background:linear-gradient(to top,#000 60%,transparent 100%);pointer-events:none}

/* ERA EFFECTS */
/* VINTAGE (≤1989): Melnbalts, tumšas malas/stūri, vecā TV estētika */
.tv-screen.era-vintage .yt-slot{filter:grayscale(1) brightness(0.78) contrast(1.18) sepia(0.15);transition:filter .8s ease,opacity 2s ease}
.tv-screen.era-vcr .yt-slot{filter:saturate(0.55) contrast(1.1) brightness(0.88) sepia(0.05);transition:filter .8s ease,opacity 2s ease}
.tv-screen.era-modern .yt-slot{filter:none;transition:filter .8s ease,opacity 2s ease}
/* Vintage vinjete — tumši stūri un malas, kā vecā TV */
.era-overlay-vintage{position:absolute;inset:0;pointer-events:none;border-radius:inherit;z-index:4;opacity:0;transition:opacity .8s ease;
  background:
    radial-gradient(ellipse at center,transparent 30%,rgba(0,0,0,0.5) 65%,rgba(0,0,0,0.85) 100%),
    radial-gradient(circle at 8% 8%,rgba(0,0,0,0.4) 0%,transparent 35%),
    radial-gradient(circle at 92% 8%,rgba(0,0,0,0.4) 0%,transparent 35%),
    radial-gradient(circle at 8% 92%,rgba(0,0,0,0.4) 0%,transparent 35%),
    radial-gradient(circle at 92% 92%,rgba(0,0,0,0.4) 0%,transparent 35%)}
.tv-screen.era-vintage .era-overlay-vintage{opacity:1}
/* Vintage grain/noise overlay */
.era-overlay-vintage-grain{position:absolute;inset:0;pointer-events:none;border-radius:inherit;z-index:4;opacity:0;transition:opacity .8s ease;
  background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.12'/%3E%3C/svg%3E");
  background-size:128px 128px;mix-blend-mode:overlay}
.tv-screen.era-vintage .era-overlay-vintage-grain{opacity:1;animation:vintageGrain .08s steps(1) infinite}
@keyframes vintageGrain{0%{background-position:0 0}25%{background-position:-32px 16px}50%{background-position:16px -32px}75%{background-position:-16px -16px}100%{background-position:0 0}}
/* Vintage horizontal lines (old TV scanline effect, thicker) */
.era-overlay-vintage-lines{position:absolute;inset:0;pointer-events:none;border-radius:inherit;z-index:4;opacity:0;transition:opacity .8s ease;
  background:repeating-linear-gradient(0deg,transparent 0px,transparent 3px,rgba(0,0,0,0.12) 3px,rgba(0,0,0,0.12) 4px)}
.tv-screen.era-vintage .era-overlay-vintage-lines{opacity:1}

/* VHS/VCR (1990-2000): Noise, tracking lines, chromatic aberration */
.era-overlay-vcr{position:absolute;inset:0;pointer-events:none;border-radius:inherit;z-index:4;opacity:0;transition:opacity .8s ease;
  background:repeating-linear-gradient(0deg,transparent 0px,transparent 2px,rgba(0,0,0,0.06) 2px,rgba(0,0,0,0.06) 3px,transparent 3px,transparent 5px)}
.tv-screen.era-vcr .era-overlay-vcr{opacity:1;animation:vcrNoise .12s steps(1) infinite}
@keyframes vcrNoise{0%{background-position:0 0}25%{background-position:0 -2px}50%{background-position:0 1px}75%{background-position:0 -1px}100%{background-position:0 0}}
/* VHS chromatic aberration (color fringing) */
.era-overlay-vcr-chroma{position:absolute;inset:0;pointer-events:none;border-radius:inherit;z-index:3;opacity:0;transition:opacity .8s ease;
  background:linear-gradient(90deg,rgba(255,0,80,0.035) 0%,transparent 20%,transparent 80%,rgba(0,80,255,0.035) 100%)}
.tv-screen.era-vcr .era-overlay-vcr-chroma{opacity:1}
/* VHS tracking band — horizontal white line drifting up */
.era-overlay-vcr-band{position:absolute;left:0;right:0;pointer-events:none;z-index:5;opacity:0;transition:opacity .8s ease;
  height:4px;background:rgba(255,255,255,0.08);filter:blur(1px);box-shadow:0 0 12px rgba(255,255,255,0.04)}
.tv-screen.era-vcr .era-overlay-vcr-band{opacity:1;animation:vcrBandDrift 6s linear infinite}
@keyframes vcrBandDrift{0%{top:100%;opacity:0}3%{opacity:1}97%{opacity:1}100%{top:-4px;opacity:0}}
/* VHS noise/grain overlay */
.era-overlay-vcr-grain{position:absolute;inset:0;pointer-events:none;border-radius:inherit;z-index:4;opacity:0;transition:opacity .8s ease;
  background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.7' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.08'/%3E%3C/svg%3E");
  background-size:100px 100px;mix-blend-mode:overlay}
.tv-screen.era-vcr .era-overlay-vcr-grain{opacity:1;animation:vhsGrain .1s steps(1) infinite}
@keyframes vhsGrain{0%{background-position:0 0}33%{background-position:-20px 10px}66%{background-position:10px -20px}100%{background-position:0 0}}
/* VHS occasional glitch — horizontal shift */
.era-overlay-vcr-glitch{position:absolute;inset:0;pointer-events:none;border-radius:inherit;z-index:5;opacity:0;overflow:hidden}
.tv-screen.era-vcr .era-overlay-vcr-glitch{animation:vhsGlitchFlash 8s ease-in-out infinite}
@keyframes vhsGlitchFlash{0%,92%,100%{opacity:0}93%{opacity:1}94%{opacity:0}96%{opacity:1}97%{opacity:0}}

/* SCREEN OVERLAYS */
@keyframes logoPulse{0%,100%{text-shadow:0 0 8px var(--neon-purple),0 0 16px rgba(155,77,255,0.4)}50%{text-shadow:0 0 14px var(--neon-purple),0 0 28px rgba(155,77,255,0.7)}}
.screen-logo{position:absolute;top:16px;left:20px;z-index:10;display:flex;align-items:center;gap:3px;background:none;border:none;padding:12px 22px 12px 16px;border-radius:0}
@keyframes miniStripeScroll{0%{background-position:0 0}100%{background-position:0 7px}}
.screen-logo-l{font-family:'Bowlby One SC',sans-serif;font-size:58px;font-weight:400;letter-spacing:2px;line-height:1;text-transform:uppercase;
  background:repeating-linear-gradient(0deg,var(--neon-purple) 0px,var(--neon-purple) 5px,transparent 5px,transparent 7px);
  background-size:100% 7px;-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent;
  filter:drop-shadow(0 0 6px var(--neon-purple));
  animation:miniStripeScroll 2.5s linear infinite}
.screen-logo-o-sphere{display:inline-flex;align-items:center;justify-content:center;width:60px;height:74px;position:relative;margin:0 -1px;flex-shrink:0;perspective:320px}
.screen-logo-o-sphere .screen-logo-sphere{--c:var(--neon-purple);width:60px;height:60px;margin:0;left:1px;top:6px;position:absolute;transform-style:preserve-3d;animation:sphereSpin 10s linear infinite}
.screen-logo-o-sphere .screen-logo-sphere div{--sz:23%;--s:2s;--d:40;--dv:calc(var(--s)/var(--d));--dl:calc(var(--dv)*-1);width:var(--sz);height:var(--sz);position:absolute;border:0.12vmin solid var(--c);border-radius:100%;transform:rotateX(90deg) translateZ(34px);box-shadow:0 0 0.24vmin 0.24vmin var(--c),0 0 0.24vmin 0.24vmin var(--c) inset;animation:sphereShine var(--s) linear var(--dl) infinite;background:transparent;left:50%;top:50%;margin-left:calc(var(--sz)/-2);margin-top:calc(var(--sz)/-2)}
.screen-logo-o-sphere .screen-logo-sphere div:nth-child(2){--sz:40%;--dl:calc(var(--dv)*-2);transform:rotateX(90deg) translateZ(30px)}
.screen-logo-o-sphere .screen-logo-sphere div:nth-child(3){--sz:55%;--dl:calc(var(--dv)*-3);transform:rotateX(90deg) translateZ(27px)}
.screen-logo-o-sphere .screen-logo-sphere div:nth-child(4){--sz:68%;--dl:calc(var(--dv)*-4);transform:rotateX(90deg) translateZ(23px)}
.screen-logo-o-sphere .screen-logo-sphere div:nth-child(5){--sz:78%;--dl:calc(var(--dv)*-5);transform:rotateX(90deg) translateZ(20px)}
.screen-logo-o-sphere .screen-logo-sphere div:nth-child(6){--sz:86%;--dl:calc(var(--dv)*-6);transform:rotateX(90deg) translateZ(15px)}
.screen-logo-o-sphere .screen-logo-sphere div:nth-child(7){--sz:92%;--dl:calc(var(--dv)*-7);transform:rotateX(90deg) translateZ(11px)}
.screen-logo-o-sphere .screen-logo-sphere div:nth-child(8){--sz:96%;--dl:calc(var(--dv)*-8);transform:rotateX(90deg) translateZ(8px)}
.screen-logo-o-sphere .screen-logo-sphere div:nth-child(9){--sz:99%;--dl:calc(var(--dv)*-9);transform:rotateX(90deg) translateZ(5px)}
.screen-logo-o-sphere .screen-logo-sphere div:nth-child(10){--sz:100%;--dl:calc(var(--dv)*-10);transform:rotateX(90deg) translateZ(2px)}
.screen-logo-o-sphere .screen-logo-sphere div:nth-child(11){--sz:100%;--dl:calc(var(--dv)*-11);transform:rotateX(90deg) translateZ(0)}
.screen-logo-o-sphere .screen-logo-sphere div:nth-child(12){--sz:99%;--dl:calc(var(--dv)*-12);transform:rotateX(90deg) translateZ(-2px)}
.screen-logo-o-sphere .screen-logo-sphere div:nth-child(13){--sz:96%;--dl:calc(var(--dv)*-13);transform:rotateX(90deg) translateZ(-5px)}
.screen-logo-o-sphere .screen-logo-sphere div:nth-child(14){--sz:92%;--dl:calc(var(--dv)*-14);transform:rotateX(90deg) translateZ(-8px)}
.screen-logo-o-sphere .screen-logo-sphere div:nth-child(15){--sz:86%;--dl:calc(var(--dv)*-15);transform:rotateX(90deg) translateZ(-11px)}
.screen-logo-o-sphere .screen-logo-sphere div:nth-child(16){--sz:78%;--dl:calc(var(--dv)*-16);transform:rotateX(90deg) translateZ(-15px)}
.screen-logo-o-sphere .screen-logo-sphere div:nth-child(17){--sz:68%;--dl:calc(var(--dv)*-17);transform:rotateX(90deg) translateZ(-20px)}
.screen-logo-o-sphere .screen-logo-sphere div:nth-child(18){--sz:55%;--dl:calc(var(--dv)*-18);transform:rotateX(90deg) translateZ(-23px)}
.screen-logo-o-sphere .screen-logo-sphere div:nth-child(19){--sz:40%;--dl:calc(var(--dv)*-19);transform:rotateX(90deg) translateZ(-27px)}
.screen-logo-o-sphere .screen-logo-sphere div:nth-child(20){--sz:23%;--dl:calc(var(--dv)*-20);transform:rotateX(90deg) translateZ(-30px)}
.screen-logo-o-sphere .screen-logo-sphere div:nth-child(21){--sz:10%;--dl:calc(var(--dv)*-21);transform:rotateX(90deg) translateZ(-34px)}
.screen-logo-m{font-family:'Sigmar One',sans-serif;font-size:56px;font-weight:400;letter-spacing:2px;line-height:1;text-transform:uppercase;
  background:repeating-linear-gradient(0deg,var(--neon-purple) 0px,var(--neon-purple) 5px,transparent 5px,transparent 7px);
  background-size:100% 7px;-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent;
  filter:drop-shadow(0 0 6px var(--neon-purple));
  animation:miniStripeScroll 2.5s linear infinite}
.screen-logo-tv{font-family:'Gveret Levin',cursive;font-size:28px;font-weight:400;color:var(--electric-blue);letter-spacing:1px;
  text-shadow:0 0 8px rgba(25,208,232,0.7);transform:rotate(-8deg);display:inline-block;margin-left:-10px;align-self:flex-start;position:relative;top:4px}
.ch-switch-overlay{position:absolute;top:13px;right:14px;z-index:15;font-family:var(--font-display);font-size:32px;font-weight:900;color:var(--light-blurple);text-shadow:0 0 14px rgba(88,101,242,0.9);opacity:0;transition:opacity .15s;background:rgba(0,0,0,0.75);padding:3px 14px;border:1px solid rgba(88,101,242,0.35);border-radius:4px;letter-spacing:2px}
.ch-switch-overlay.show{opacity:1}
/* TV Info Overlay — 3 phase system */
.tv-overlay{position:absolute;bottom:100px;left:24px;z-index:14;pointer-events:none;
  transform:translateX(-110%);opacity:0;transition:transform .6s cubic-bezier(.22,1,.36,1),opacity .5s ease;
  max-width:520px}
.tv-overlay.show{transform:translateX(0);opacity:1}
.tv-overlay-inner{background:rgba(0,0,0,0.88);backdrop-filter:blur(12px);border-left:5px solid var(--neon-purple);
  padding:20px 28px 16px;border-radius:0 10px 10px 0;
  box-shadow:0 6px 30px rgba(0,0,0,0.7),0 0 30px rgba(155,77,255,0.2),0 0 60px rgba(155,77,255,0.08)}
.tv-overlay-label{font-family:'Handjet',var(--font-main),sans-serif;font-size:22px;font-weight:700;letter-spacing:6px;text-transform:uppercase;margin-bottom:8px;
  color:var(--neon-purple);text-shadow:0 0 12px rgba(155,77,255,0.7),0 0 24px rgba(155,77,255,0.3)}
.tv-overlay.phase-next .tv-overlay-inner{border-left-color:var(--electric-blue);box-shadow:0 6px 30px rgba(0,0,0,0.7),0 0 30px rgba(25,208,232,0.2),0 0 60px rgba(25,208,232,0.08)}
.tv-overlay.phase-next .tv-overlay-label{color:var(--electric-blue);text-shadow:0 0 12px rgba(25,208,232,0.7),0 0 24px rgba(25,208,232,0.3)}
.tv-overlay.phase-just .tv-overlay-inner{border-left-color:var(--hot-pink);opacity:0.85;box-shadow:0 6px 30px rgba(0,0,0,0.7),0 0 30px rgba(255,76,210,0.2),0 0 60px rgba(255,76,210,0.08)}
.tv-overlay.phase-just .tv-overlay-label{color:var(--hot-pink);text-shadow:0 0 12px rgba(255,76,210,0.7),0 0 24px rgba(255,76,210,0.3)}
.tv-overlay-title{font-family:'Russo One',var(--font-display),sans-serif;font-size:26px;font-weight:400;color:#fff;margin-bottom:6px;line-height:1.15;
  overflow:hidden;text-overflow:ellipsis;white-space:nowrap;text-shadow:0 2px 8px rgba(0,0,0,0.9),0 0 16px rgba(155,77,255,0.15)}
.tv-overlay-artist{font-family:'Russo One',var(--font-display),sans-serif;font-size:20px;font-weight:400;color:rgba(200,210,240,0.75);
  overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-style:normal;letter-spacing:0.5px}
.tv-overlay-meta{font-family:'Handjet',var(--font-main),sans-serif;font-size:15px;font-weight:500;color:rgba(224,227,255,0.5);letter-spacing:3px;margin-top:5px}
/* Legacy now-playing compat — keep for channel display */
.now-playing{display:none}
.screen-progress{position:absolute;bottom:28px;left:0;right:0;z-index:10;height:3px;background:rgba(255,255,255,0.05);pointer-events:none}
.screen-progress-fill{height:100%;width:0%;background:linear-gradient(90deg,var(--hot-pink),var(--neon-purple),var(--electric-blue));box-shadow:0 0 8px rgba(255,76,210,0.6);transition:width .3s}
.sms-ticker-screen{position:absolute;bottom:0;left:0;right:0;z-index:26;height:64px;overflow:hidden;background:rgba(0,0,10,0.88);border-top:2px solid rgba(88,101,242,0.25);pointer-events:none}
.sms-ticker-screen.off{display:none}
.sms-ticker-inner{display:flex;position:absolute;top:0;left:0;height:100%;white-space:nowrap;align-items:center;animation:tickerScroll 60s linear infinite}
@keyframes tickerScroll{0%{transform:translateX(0)}100%{transform:translateX(-50%)}}
.sms-item{font-family:var(--font-main);font-size:18px;font-weight:500;padding:0 28px;flex-shrink:0}
.sms-name{color:rgba(130,140,170,0.65);font-weight:700}
.sms-text{color:rgba(140,148,175,0.5)}
.sms-sep{color:var(--blurple);margin:0 8px;opacity:0.6}
/* Volume OSD — NMTV green blocks style */
.vol-osd{position:absolute;bottom:80px;left:30px;z-index:18;display:none;flex-direction:column;gap:6px;
  background:
    linear-gradient(140deg,rgba(0,0,0,0.8),rgba(0,0,0,0.9)),
    repeating-linear-gradient(0deg,rgba(53,237,126,0.08) 0px,rgba(53,237,126,0.08) 1px,transparent 1px,transparent 3px),
    repeating-linear-gradient(90deg,rgba(53,237,126,0.06) 0px,rgba(53,237,126,0.06) 1px,transparent 1px,transparent 3px);
  border:2px solid #35ed7e;border-radius:6px;padding:12px 18px;
  backdrop-filter:blur(4px);min-width:240px}
.vol-osd.show{display:flex}
.vol-osd-label{font-family:var(--font-display);font-size:18px;font-weight:800;color:#35ed7e;letter-spacing:3px;text-transform:uppercase;text-shadow:0 0 8px rgba(53,237,126,0.6)}
.vol-osd-bar{display:flex;align-items:center;gap:0;height:28px}
.vol-osd-blocks{display:flex;gap:3px;height:100%;align-items:flex-end}
.vol-osd-block{width:12px;border-radius:2px;background:#35ed7e;box-shadow:0 0 4px rgba(53,237,126,0.6);transition:height .08s}
.vol-osd-dashes{display:flex;gap:3px;height:100%;align-items:center;flex:1}
.vol-osd-dash{width:12px;height:3px;background:#35ed7e;opacity:0.3;border-radius:1px}
.vol-osd-value{font-family:var(--font-display);font-size:32px;font-weight:900;color:#35ed7e;text-shadow:0 0 10px rgba(53,237,126,0.6);line-height:1;position:absolute;right:18px;top:50%;transform:translateY(-50%)}
/* Muted overlay */
.mute-osd{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);z-index:18;display:none;flex-direction:column;align-items:center;gap:6px;
  background:
    linear-gradient(140deg,rgba(0,0,0,0.82),rgba(0,0,0,0.92)),
    repeating-linear-gradient(0deg,rgba(53,237,126,0.08) 0px,rgba(53,237,126,0.08) 1px,transparent 1px,transparent 3px),
    repeating-linear-gradient(90deg,rgba(53,237,126,0.06) 0px,rgba(53,237,126,0.06) 1px,transparent 1px,transparent 3px);
  border:2px solid #35ed7e;border-radius:8px;padding:20px 36px;
  backdrop-filter:blur(4px)}
.mute-osd.show{display:flex}
.mute-osd-icon{font-size:36px}
.mute-osd-text{font-family:var(--font-display);font-size:28px;font-weight:900;color:#35ed7e;letter-spacing:4px;text-shadow:0 0 10px rgba(53,237,126,0.6)}
.mute-osd-sub{font-family:var(--font-main);font-size:14px;font-weight:600;color:#35ed7e;letter-spacing:2px;opacity:0.7;text-transform:uppercase}

.static-noise{position:absolute;inset:0;z-index:20;background:#000;display:none;align-items:center;justify-content:center;border-radius:inherit}
.static-noise.show{display:flex}
.static-noise canvas{width:100%;height:100%;border-radius:inherit}
.power-off-screen{position:absolute;inset:0;z-index:22;background:#000;display:none;align-items:center;justify-content:center;border-radius:inherit}
.power-off-screen.show{display:flex}
.power-dot{width:6px;height:6px;background:#fff;border-radius:50%;box-shadow:0 0 30px rgba(255,255,255,0.9),0 0 60px rgba(200,200,255,0.5);animation:powerOff .6s ease-out forwards}
@keyframes powerOff{0%{width:100%;height:3px;border-radius:0;opacity:1;box-shadow:0 0 40px rgba(255,255,255,0.9)}40%{width:40px;height:3px;border-radius:0;opacity:1;box-shadow:0 0 30px rgba(255,255,255,0.8)}70%{width:8px;height:3px;border-radius:1px;opacity:0.9}100%{width:4px;height:4px;border-radius:50%;opacity:0;box-shadow:0 0 10px rgba(255,255,255,0.3)}}

/* RIGHT PANEL — Glossy Black Plastic */
.tv-panel{position:absolute;top:10px;bottom:10px;right:10px;width:var(--panel-w);overflow:hidden;
  background:
    linear-gradient(rgba(255,255,255,0.03) 1px,transparent 1px) 0 0 / 20px 20px,
    linear-gradient(90deg,rgba(255,255,255,0.03) 1px,transparent 1px) 0 0 / 20px 20px,
    linear-gradient(170deg,rgba(255,255,255,0.015) 0%,transparent 30%,transparent 70%,rgba(255,255,255,0.01) 100%),
    linear-gradient(90deg,#0d0d0d 0%,#141414 50%,#0d0d0d 100%);
  border-left:1px solid rgba(192,192,192,0.08);
  border-radius:16px;
  display:flex;flex-direction:column;padding:20px 16px 0;gap:16px;overflow:hidden;
  box-shadow:
    -6px 0 24px rgba(0,0,0,0.9),
    inset 2px 0 1px rgba(255,255,255,0.04),
    inset -1px 0 1px rgba(0,0,0,0.5),
    0 0 0 1px rgba(255,255,255,0.06),
    0 4px 16px rgba(0,0,0,0.6),
    inset 0 1px 0 rgba(255,255,255,0.03)}
.tv-panel::-webkit-scrollbar{width:4px}
.tv-panel::-webkit-scrollbar-track{background:transparent}
.tv-panel::-webkit-scrollbar-thumb{background:rgba(88,101,242,0.2);border-radius:4px}
.tv-panel::-webkit-scrollbar-thumb:hover{background:rgba(88,101,242,0.4)}
.tv-panel::before{content:'';position:absolute;inset:0;border-radius:inherit;
  background:
    radial-gradient(ellipse 80% 30% at 70% 15%,rgba(255,255,255,0.06) 0%,transparent 50%),
    radial-gradient(ellipse 60% 60% at 50% 50%,rgba(155,77,255,0.04) 0%,transparent 70%),
    radial-gradient(ellipse 100% 100% at 50% 100%,rgba(0,0,0,0.3) 0%,transparent 60%);
  pointer-events:none;z-index:0}
.tv-panel > *{position:relative;z-index:1}
.panel-divider{height:1px;flex-shrink:0;background:linear-gradient(90deg,transparent,rgba(88,101,242,0.2),transparent);margin:0}
.panel-header-wrapper{position:relative;flex-shrink:0;margin-bottom:0;margin-top:-20px;padding-top:20px}
.panel-header-wrapper::before{display:none}
.panel-header-wrapper > *{position:relative;z-index:1}
.panel-header{display:flex;flex-direction:column;align-items:stretch;flex-shrink:0;padding:0 0 4px;background:transparent;border-radius:4px;gap:10px;position:relative}
.panel-header > *{position:relative;z-index:1}
.panel-header-top-row{display:flex;align-items:center;justify-content:space-between;gap:10px;overflow:hidden;position:relative}
.panel-logo{display:none}
.panel-logo-lom{font-family:var(--font-display);font-size:34px;font-weight:900;letter-spacing:3px;text-transform:uppercase;
  background:linear-gradient(135deg,#fff 0%,#e0e3ff 40%,#9b4dff 100%);
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.panel-logo-tv{font-family:var(--font-display);font-size:17px;font-weight:700;color:var(--blurple);letter-spacing:3px;opacity:0.9;margin-bottom:5px}
.panel-led{width:8px;height:8px;border-radius:50%;background:var(--neon-green);box-shadow:0 0 10px rgba(53,237,126,0.9),0 0 20px rgba(53,237,126,0.5);transition:all .3s;flex-shrink:0;animation:ledPulse 2s ease-in-out infinite}
@keyframes ledPulse{0%,100%{box-shadow:0 0 10px rgba(53,237,126,0.9),0 0 20px rgba(53,237,126,0.5)}50%{box-shadow:0 0 15px rgba(53,237,126,1),0 0 30px rgba(53,237,126,0.7)}}
.panel-led.off{background:#1a1a1a;box-shadow:inset 0 1px 2px rgba(0,0,0,0.8);animation:none}
.section-label{font-family:var(--font-main);font-size:17px;font-weight:700;color:rgba(224,227,255,0.35);letter-spacing:3px;text-transform:uppercase;flex-shrink:0;padding:0 2px}

/* CHANNEL GRID */
.channel-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;flex-shrink:0;justify-items:center;width:100%;margin-top:4px;
  background:#151515;border:1px solid rgba(255,255,255,0.08);border-radius:12px;padding:12px;
  box-shadow:inset 2px 2px 6px rgba(0,0,0,0.6),inset -1px -1px 2px rgba(255,255,255,0.03)}
.ch-btn{position:relative;border:none;background:transparent;cursor:pointer;width:100%;max-width:100%;height:52px;padding:0;overflow:hidden;border-radius:8px;perspective:600px;-webkit-tap-highlight-color:transparent;flex-shrink:0}
.ch-flipdisc{position:absolute;inset:0;transform-style:preserve-3d;transition:transform 0.52s cubic-bezier(0.7,0,0.2,1)}
.ch-btn.active .ch-flipdisc{transform:rotateX(-180deg)}
.ch-btn:hover:not(.active) .ch-flipdisc{transform:rotateX(-14deg)}
.ch-face{position:absolute;inset:0;display:flex;flex-direction:row;align-items:center;justify-content:center;gap:6px;backface-visibility:hidden;-webkit-backface-visibility:hidden;border-radius:8px;padding:0 10px}
.ch-face-front{background:linear-gradient(145deg,#2e2e2e 0%,#1a1a1a 100%);border:none;
  box-shadow:0 3px #0a0a0a,0 4px 4px rgba(0,0,0,0.5),inset 1px 1px rgba(255,255,255,0.08),inset 0 -1px 1px rgba(0,0,0,0.5)}
.ch-face-back{background:linear-gradient(145deg,rgba(155,77,255,0.35) 0%,rgba(155,77,255,0.15) 100%);transform:rotateX(180deg);border:none;
  box-shadow:0 3px rgba(60,20,120,0.9),0 4px 4px rgba(0,0,0,0.5),0 0 12px rgba(155,77,255,0.4),inset 1px 1px rgba(255,255,255,0.1)}
.ch-face .ch-icon{font-size:20px;line-height:1;filter:grayscale(0.4);flex-shrink:0}
.ch-face-back .ch-icon{filter:grayscale(0)}
.ch-face .ch-name{font-family:var(--font-main);font-size:15px;font-weight:700;color:rgba(224,227,255,0.5);line-height:1.2;text-align:center;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex:1;letter-spacing:1.5px;text-transform:uppercase}
.ch-face-front .ch-name{color:rgba(224,227,255,0.4)}
.ch-face-back .ch-name{color:var(--light-blurple);font-weight:800;text-shadow:0 0 8px rgba(88,101,242,0.6)}
.ch-btn.active::after{content:'';position:absolute;top:4px;right:4px;width:5px;height:5px;border-radius:50%;background:var(--discord-green);box-shadow:0 0 7px var(--green-glow);z-index:5}

/* RETRO CHROME BUTTON */
.wood-btn{border-radius:8px;border:none;cursor:pointer;font-family:var(--font-main);font-size:18px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;display:flex;align-items:center;justify-content:center;gap:6px;transition:all .12s;
  background:linear-gradient(145deg,#333 0%,#222 100%);
  color:var(--electric-blue);
  box-shadow:0 3px #111,0 4px 4px rgba(0,0,0,0.4),inset 1px 1px rgba(255,255,255,0.1),0 0 8px rgba(25,208,232,0.15);
  padding:8px 12px}
.wood-btn:hover{background:linear-gradient(145deg,#3a3a3a,#2a2a2a);
  color:var(--pure-white);
  box-shadow:0 3px #111,0 4px 4px rgba(0,0,0,0.4),inset 1px 1px rgba(255,255,255,0.12),0 0 14px rgba(25,208,232,0.3)}
.wood-btn:active{transform:translateY(3px);box-shadow:0 0 #111,inset 2px 2px 4px rgba(0,0,0,0.6),0 0 10px rgba(25,208,232,0.3)}

/* NOW PLAYING */
.panel-np{flex-shrink:0;background:#151515;border-radius:10px;border:1px solid rgba(255,255,255,0.08);padding:10px 12px;display:flex;flex-direction:column;gap:8px;
  box-shadow:inset 2px 2px 6px rgba(0,0,0,0.6),inset -1px -1px 2px rgba(255,255,255,0.03)}
.panel-np-row1{display:flex;align-items:center;gap:8px}
.np-indicator{width:7px;height:7px;border-radius:50%;flex-shrink:0;background:rgba(224,227,255,0.2);box-shadow:none;animation:npPulse 2s ease-in-out infinite}
.np-indicator.playing{background:var(--discord-green);box-shadow:0 0 7px var(--green-glow)}
@keyframes npPulse{0%,100%{opacity:1}50%{opacity:0.3}}
.panel-np-title{font-family:var(--font-main);font-size:20px;font-weight:500;color:rgba(224,227,255,0.7);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;flex:1}
.panel-np-row2{display:flex;align-items:center;gap:8px}
.panel-np-btns{display:flex;gap:6px}
.np-sm-btn{width:40px;height:40px;border-radius:6px;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:18px;transition:all .12s;
  background:linear-gradient(145deg,#333,#222);color:var(--light-blurple);
  box-shadow:0 2px #111,0 3px 3px rgba(0,0,0,0.4),inset 1px 1px rgba(255,255,255,0.08)}
.np-sm-btn:hover{background:linear-gradient(145deg,#3a3a3a,#2a2a2a);color:var(--pure-white)}
.np-sm-btn:active{transform:translateY(2px);box-shadow:0 0 #111,inset 2px 2px 4px rgba(0,0,0,0.6)}
.panel-progress{flex:1;height:3px;background:rgba(88,101,242,0.1);border-radius:2px;overflow:hidden}
.panel-progress-fill{height:100%;width:0%;background:linear-gradient(90deg,var(--dark-blurple),var(--blurple),var(--light-blurple));border-radius:2px;transition:width .3s}

/* CH ARROWS - D-PAD STYLE */
.ch-arrows-row{display:flex;flex-direction:column;gap:8px;flex-shrink:0;flex:1;align-items:center}
.ch-arrows-label{font-family:var(--font-main);font-size:13px;font-weight:700;color:rgba(224,227,255,0.4);letter-spacing:2px;text-transform:uppercase;margin-bottom:2px}
.ch-dpad{display:grid;grid-template-columns:repeat(3,40px);grid-template-rows:repeat(3,40px);gap:6px;align-items:center;justify-items:center}
.ch-dpad-btn{width:40px;height:40px;background:rgba(88,101,242,0.1);border:1px solid rgba(88,101,242,0.2);border-radius:4px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:20px;color:rgba(224,227,255,0.7);transition:all .15s;grid-column:2;grid-row:2}
.ch-dpad-btn.up{grid-column:2;grid-row:1}
.ch-dpad-btn.down{grid-column:2;grid-row:3}
.ch-dpad-btn.left{grid-column:1;grid-row:2}
.ch-dpad-btn.right{grid-column:3;grid-row:2}
.ch-dpad-btn:hover{background:rgba(88,101,242,0.25);border-color:rgba(88,101,242,0.5);color:var(--pure-white)}
.ch-dpad-btn:active{transform:translateY(1px)}
.ch-dpad-center{grid-column:2;grid-row:2;width:40px;height:40px;display:flex;align-items:center;justify-content:center;font-family:var(--font-main);font-size:12px;font-weight:700;color:rgba(224,227,255,0.2);text-transform:uppercase;pointer-events:none;letter-spacing:1px}
/* CONTROL BUTTONS — 3-Column Layout */
.controls-section{display:flex;flex-direction:column;gap:10px;align-items:stretch;width:100%;flex-shrink:0;position:relative;
  background:#151515;border:1px solid rgba(255,255,255,0.08);border-radius:12px;padding:12px;
  box-shadow:inset 2px 2px 6px rgba(0,0,0,0.6),inset -1px -1px 2px rgba(255,255,255,0.03)}
.controls-section > *{position:relative;z-index:1}

/* 3-column grid: [MUTE/VOL−] [CH] [INFO/VOL+] */
.controls-3col{display:grid;grid-template-columns:1fr auto 1fr;gap:8px;align-items:end}
.ctrl-col{display:flex;flex-direction:column;gap:6px}
.ctrl-col-center{align-self:stretch}

/* MUTE & INFO — short buttons */
.ctrl-btn{height:36px;border:none;border-radius:6px;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:6px;
  font-family:var(--font-main);font-size:17px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;
  color:rgba(224,227,255,0.8);
  background:linear-gradient(145deg,#333,#222);
  box-shadow:0 3px #111,0 4px 4px rgba(0,0,0,0.4),inset 1px 1px rgba(255,255,255,0.1);
  transition:all .12s}
.ctrl-btn:hover{background:linear-gradient(145deg,#3a3a3a,#2a2a2a);color:var(--pure-white)}
.ctrl-btn:active{transform:translateY(3px);box-shadow:0 0 #111,inset 2px 2px 4px rgba(0,0,0,0.6)}
.ctrl-btn .ctrl-arrow{font-size:18px;color:rgba(224,227,255,0.5)}
/* VOL triangles: left ◄ bigger, right ► bigger, pushed to edges */
#volDownBtn .ctrl-arrow{font-size:28px;margin-left:-4px;margin-right:2px}
#volUpBtn .ctrl-arrow{font-size:24px;margin-right:-4px;margin-left:2px}
.ctrl-btn .ctrl-label{white-space:nowrap}

/* MUTE active state */
#muteBtn.active{background:linear-gradient(145deg,rgba(53,237,126,0.3),rgba(53,237,126,0.15));
  color:rgba(53,237,126,0.95);box-shadow:0 3px rgba(20,80,40,0.8),0 4px 4px rgba(0,0,0,0.4),0 0 8px rgba(53,237,126,0.15)}

/* VOL− / VOL+ — taller buttons aligned to CH bottom */
#volDownBtn,#volUpBtn{height:52px;font-size:16px;letter-spacing:1px}

/* CH vertical button */
.ch-vertical-btn{width:60px;height:auto;min-height:96px;
  background:linear-gradient(145deg,#333,#222);
  border:1px solid rgba(255,255,255,0.08);border-radius:8px;
  display:flex;flex-direction:column;align-items:center;justify-content:space-between;padding:6px 4px;cursor:default;
  box-shadow:0 3px #111,0 4px 4px rgba(0,0,0,0.4),inset 1px 1px rgba(255,255,255,0.08);
  transition:all .15s;flex-shrink:0}
.ch-vertical-btn-top{flex:1;width:100%;display:flex;align-items:center;justify-content:center;font-size:26px;color:rgba(224,227,255,0.8);border-bottom:1px solid rgba(255,255,255,0.06);cursor:pointer;transition:background .15s;line-height:1;border-radius:4px 4px 0 0}
.ch-vertical-btn-top:hover{background:rgba(88,101,242,0.2);color:var(--pure-white)}
.ch-vertical-btn-center{flex-shrink:0;font-family:var(--font-main);font-size:17px;font-weight:700;color:rgba(224,227,255,0.35);letter-spacing:2px;text-transform:uppercase;padding:4px 0;pointer-events:none}
.ch-vertical-btn-bottom{flex:1;width:100%;display:flex;align-items:center;justify-content:center;font-size:26px;color:rgba(224,227,255,0.8);border-top:1px solid rgba(255,255,255,0.06);cursor:pointer;transition:background .15s;line-height:1;border-radius:0 0 4px 4px}
.ch-vertical-btn-bottom:hover{background:rgba(88,101,242,0.2);color:var(--pure-white)}

/* POWER + UTILITIES */
/* Horizontal Power Button */
.power-btn-horizontal{flex:1;height:44px;border:none;border-radius:8px;cursor:pointer;font-family:var(--font-main);font-size:17px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;display:flex;align-items:center;justify-content:center;gap:5px;transition:all .12s;color:rgba(224,227,255,0.8);position:relative;overflow:hidden;min-width:0;
  background:linear-gradient(145deg,#333,#222);
  box-shadow:0 3px #111,0 4px 4px rgba(0,0,0,0.4),inset 1px 1px rgba(255,255,255,0.1)}
.power-btn-horizontal::before{display:none}
.power-btn-horizontal.fullscreen{width:100%;height:auto;flex:0 0 auto;position:static;z-index:auto;pointer-events:auto}
.power-btn-horizontal.fullscreen:hover{background:linear-gradient(145deg,#3a3a3a,#2a2a2a);color:var(--pure-white)}
.power-btn-horizontal.fullscreen.active{background:linear-gradient(145deg,rgba(53,237,126,0.25),rgba(53,237,126,0.12));color:rgba(53,237,126,0.95);box-shadow:0 3px rgba(20,80,40,0.8),0 4px 4px rgba(0,0,0,0.4),0 0 8px rgba(53,237,126,0.15);position:static;z-index:auto;pointer-events:auto}
.power-btn-horizontal:hover{background:linear-gradient(145deg,#3a3a3a,#2a2a2a);color:var(--pure-white)}
.power-btn-horizontal:active{transform:translateY(3px);box-shadow:0 0 #111,inset 2px 2px 4px rgba(0,0,0,0.6)}
.power-btn-horizontal .power-icon{position:relative;z-index:1;font-size:21px}
.power-btn-horizontal .power-text{position:relative;z-index:1;font-weight:700}
/* (Old extra-wide-btn, mute-vol-row, #muteBtn, #extraRightBtn removed — replaced by .controls-3col layout) */
/* ON/OFF — always red/crimson */
#powerBtnHorizontal{
  background:linear-gradient(145deg,#4a1818,#2a0e0e);
  border:none;
  color:#ff4444;
  box-shadow:0 3px #1a0a0a,0 4px 4px rgba(0,0,0,0.4),0 0 12px rgba(255,68,68,0.25),inset 1px 1px rgba(255,255,255,0.08)}
#powerBtnHorizontal:hover{
  background:linear-gradient(145deg,#6a2222,#4a1414);
  color:#ff6666;
  box-shadow:0 3px #1a0a0a,0 4px 4px rgba(0,0,0,0.4),0 0 24px rgba(255,68,68,0.5),inset 1px 1px rgba(255,255,255,0.12);
  transform:scale(1.03)}
#powerBtnHorizontal.active{
  background:linear-gradient(145deg,#4a1818,#2a0e0e);
  color:#ff4444;
  box-shadow:0 3px #1a0a0a,0 4px 4px rgba(0,0,0,0.4),0 0 16px rgba(255,68,68,0.35),inset 1px 1px rgba(255,255,255,0.08)}
#powerBtnHorizontal.active:hover{
  background:linear-gradient(145deg,#6a2222,#4a1414);
  color:#ff6666;
  box-shadow:0 3px #1a0a0a,0 4px 4px rgba(0,0,0,0.4),0 0 24px rgba(255,68,68,0.5),inset 1px 1px rgba(255,255,255,0.12);
  transform:scale(1.03)}
/* FULL — always green */
#fullscreenBtn{
  background:linear-gradient(145deg,#183a18,#0e2a0e);
  border:none;
  color:#35ed7e;
  box-shadow:0 3px #0a1a0a,0 4px 4px rgba(0,0,0,0.4),0 0 12px rgba(53,237,126,0.25),inset 1px 1px rgba(255,255,255,0.08)}
#fullscreenBtn:hover{
  background:linear-gradient(145deg,#226a22,#184a18);
  color:#66ff99;
  box-shadow:0 3px #0a1a0a,0 4px 4px rgba(0,0,0,0.4),0 0 24px rgba(53,237,126,0.5),inset 1px 1px rgba(255,255,255,0.12);
  transform:scale(1.03)}
.power-top-row{display:flex;justify-content:center;align-items:stretch;gap:8px;width:100%;flex-shrink:0;overflow:visible;position:relative}
.power-top-row .power-btn-horizontal{aspect-ratio:1;width:auto;height:auto;min-width:0;flex:1;flex-direction:column;gap:0;padding:8px;border-radius:8px;justify-content:center;align-items:center}
.power-top-row .power-btn-horizontal.fullscreen{aspect-ratio:1;width:auto;height:auto;flex:1;flex-direction:column;gap:0;padding:8px}
.btn-icon-wrap{display:flex;align-items:center;justify-content:center;width:80%;aspect-ratio:1;position:relative}
.power-circle{border:6px solid currentColor;border-radius:50%;position:relative}
.power-circle::before{content:'';position:absolute;top:-14px;left:50%;transform:translateX(-50%);width:6px;height:30px;background:currentColor;border-radius:4px}
.full-square{border:none;border-radius:0;position:relative}
.full-square::before,
.full-square::after{content:'';position:absolute}
.full-square::before{top:0;left:0;
  border-top:6px solid currentColor;border-left:6px solid currentColor;
  width:20px;height:20px;background:none}
.full-square::after{bottom:0;right:0;
  border-bottom:6px solid currentColor;border-right:6px solid currentColor;
  width:20px;height:20px}
.full-corner-tl,.full-corner-tr,.full-corner-bl,.full-corner-br{position:absolute;width:20px;height:20px}
.full-corner-tr{top:0;right:0;border-top:6px solid currentColor;border-right:6px solid currentColor}
.full-corner-bl{bottom:0;left:0;border-bottom:6px solid currentColor;border-left:6px solid currentColor}
.btn-icon-wrap .power-text{font-size:16px;font-weight:800;letter-spacing:2px;position:relative;z-index:1}
.panel-header{display:flex;flex-direction:column;gap:12px}
.power-label{font-family:var(--font-main);font-size:17px;font-weight:700;color:rgba(224,227,255,0.35);letter-spacing:2px;text-transform:uppercase}
/* Retro VU Meter Bars */
.indicator-bars{display:flex;gap:2px;align-items:center;justify-content:flex-end;flex:1;padding-right:8px}
.indicator-bar{width:4px;height:16px;border-radius:1px;transition:all .2s;background:rgba(192,192,192,0.1);border:1px solid rgba(0,0,0,0.5)}
.indicator-bar:nth-child(1){background:var(--neon-green)}
.indicator-bar:nth-child(2){background:var(--neon-green)}
.indicator-bar:nth-child(3){background:var(--electric-blue)}
.indicator-bar:nth-child(4){background:rgba(25,208,232,0.3)}
.indicator-bar:nth-child(5){background:rgba(192,192,192,0.2)}
.indicator-bar:nth-child(6){background:rgba(192,192,192,0.15)}
.indicator-bar.active{height:22px;box-shadow:0 0 8px currentColor,inset 0 1px 0 rgba(255,255,255,0.3)}
/* Bottom zone: SMS + Share pinned to bottom of panel */
/* Speaker grille fills space between channels and SMS */
.speaker-grille{flex:1;min-height:30px;
  background:
    repeating-linear-gradient(0deg,
      transparent 0px,transparent 3px,
      rgba(255,255,255,0.04) 3px,rgba(255,255,255,0.04) 4px),
    repeating-linear-gradient(0deg,
      transparent 0px,transparent 7px,
      rgba(0,0,0,0.3) 7px,rgba(0,0,0,0.3) 8px);
  border-radius:8px;
  box-shadow:inset 0 2px 6px rgba(0,0,0,0.5),inset 0 -2px 6px rgba(0,0,0,0.3)}
@media(max-height:780px){.speaker-grille{display:none}}
.panel-bottom-zone{flex-shrink:0;display:flex;flex-direction:column;gap:10px;padding-top:10px;padding-bottom:16px;margin-top:auto}
.util-btns-bottom{display:flex;flex-direction:column;gap:8px;flex-shrink:0}
.util-btns-bottom .wood-btn{height:48px;width:100%;padding:0 14px;font-size:18px;border-radius:8px;
  /* Glass button style */
  background:linear-gradient(145deg,rgba(255,255,255,0.08),rgba(255,255,255,0.02));
  border:1px solid rgba(255,255,255,0.12);
  backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);
  color:var(--electric-blue);
  box-shadow:0 2px 8px rgba(0,0,0,0.4),inset 0 1px 0 rgba(255,255,255,0.1),0 0 12px rgba(25,208,232,0.1);
  text-shadow:0 0 8px rgba(25,208,232,0.4)}
.util-btns-bottom .wood-btn:hover{background:linear-gradient(145deg,rgba(255,255,255,0.14),rgba(255,255,255,0.04));
  border-color:rgba(25,208,232,0.3);color:var(--pure-white);
  box-shadow:0 2px 12px rgba(0,0,0,0.4),inset 0 1px 0 rgba(255,255,255,0.15),0 0 20px rgba(25,208,232,0.2)}
.util-btns-bottom .wood-btn:active{transform:translateY(2px);box-shadow:inset 0 2px 4px rgba(0,0,0,0.5)}

/* SMS */
.sms-panel{background:#151515;border-radius:10px;border:1px solid rgba(255,255,255,0.08);padding:10px 12px;display:flex;gap:8px;flex-direction:column;flex-shrink:0;
  box-shadow:inset 2px 2px 6px rgba(0,0,0,0.6),inset -1px -1px 2px rgba(255,255,255,0.03)}
.sms-panel.disabled{opacity:0.35;pointer-events:none}
.sms-panel-row{display:flex;gap:8px;align-items:center}
.sms-panel input,.sms-panel textarea{background:rgba(0,0,0,0.5);border:1px solid rgba(88,101,242,0.25);border-radius:6px;color:var(--light-blurple);font-family:var(--font-main);font-size:20px;font-weight:500;padding:8px 10px;outline:none;-webkit-user-select:text;user-select:text}
.sms-panel input::placeholder{color:rgba(224,227,255,0.25)}
.sms-panel input:focus{border-color:var(--blurple);background:rgba(88,101,242,0.08)}
.sms-name-input{flex:1;min-width:0}
.sms-text-input{width:100%;resize:none;min-height:56px;line-height:1.4;font-family:var(--font-main)}
.sms-send-btn{padding:10px 14px;border:none;border-radius:6px;cursor:default;font-family:var(--font-main);font-size:18px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;transition:all .12s;
  background:linear-gradient(145deg,#3a2a10,#2a1a08);
  color:rgba(255,180,50,0.45);
  box-shadow:0 2px #1a0e04,0 3px 3px rgba(0,0,0,0.4),inset 1px 1px rgba(255,200,80,0.06);
  flex-shrink:0;pointer-events:none}
.sms-send-btn.active{pointer-events:auto;cursor:pointer;
  background:linear-gradient(145deg,#4a3510,#3a2508);
  color:rgba(255,200,60,0.95);
  box-shadow:0 3px #1a0e04,0 4px 4px rgba(0,0,0,0.4),inset 1px 1px rgba(255,200,80,0.15),0 0 10px rgba(255,180,50,0.2);
  text-shadow:0 0 6px rgba(255,180,50,0.4)}
.sms-send-btn.active:hover{background:linear-gradient(145deg,#5a4018,#4a3010);color:#ffc832;
  box-shadow:0 3px #1a0e04,0 4px 4px rgba(0,0,0,0.4),inset 1px 1px rgba(255,200,80,0.2),0 0 16px rgba(255,180,50,0.35)}
.sms-send-btn:active{transform:translateY(3px);box-shadow:0 0 #1a0e04,inset 2px 2px 4px rgba(0,0,0,0.6)}


/* INFO POPUP — Retro-Futuristic style */
@keyframes infoGlitchIn{0%{clip-path:inset(100% 0 0 0);opacity:0}30%{clip-path:inset(40% 0 0 0);opacity:0.7}32%{clip-path:inset(45% 0 0 0)}60%{clip-path:inset(10% 0 0 0);opacity:1}62%{clip-path:inset(12% 0 0 0)}100%{clip-path:inset(0);opacity:1}}
@keyframes infoBorderPulse{0%,100%{border-color:rgba(25,208,232,0.4);box-shadow:0 0 20px rgba(25,208,232,0.15),inset 0 0 30px rgba(25,208,232,0.05)}50%{border-color:rgba(25,208,232,0.7);box-shadow:0 0 30px rgba(25,208,232,0.25),inset 0 0 40px rgba(25,208,232,0.08)}}
@keyframes infoScanline{0%{top:-4px}100%{top:100%}}
.info-popup-overlay{display:none;position:fixed;inset:0;z-index:200;background:rgba(0,0,0,0.6);backdrop-filter:blur(4px);align-items:center;justify-content:center}
.info-popup-overlay.show{display:flex}
.info-popup{position:relative;width:820px;max-width:94vw;max-height:82vh;display:flex;flex-direction:column;
  background:
    linear-gradient(160deg,rgba(4,18,8,0.96),rgba(2,8,6,0.98)),
    repeating-linear-gradient(0deg,rgba(53,237,126,0.05) 0px,rgba(53,237,126,0.05) 1px,transparent 1px,transparent 3px),
    repeating-linear-gradient(90deg,rgba(53,237,126,0.04) 0px,rgba(53,237,126,0.04) 1px,transparent 1px,transparent 3px);
  border:2px solid rgba(53,237,126,0.55);
  border-radius:6px;
  padding:0;overflow:hidden;
  box-shadow:0 0 32px rgba(53,237,126,0.22),0 16px 60px rgba(0,0,0,0.8),inset 0 0 36px rgba(53,237,126,0.08);
  animation:infoGlitchIn 0.4s ease-out,infoBorderPulse 3s ease-in-out infinite}
/* Scanline effect on popup */
.info-popup::before{content:'';position:absolute;left:0;right:0;height:4px;z-index:5;pointer-events:none;
  background:linear-gradient(90deg,transparent,rgba(53,237,126,0.25),transparent);
  animation:infoScanline 3s linear infinite}
/* Corner decorations */
.info-popup::after{content:'';position:absolute;inset:0;pointer-events:none;z-index:4;
  background:
    linear-gradient(135deg,rgba(53,237,126,0.15) 0%,transparent 3%),
    linear-gradient(225deg,rgba(53,237,126,0.15) 0%,transparent 3%),
    linear-gradient(315deg,rgba(53,237,126,0.15) 0%,transparent 3%),
    linear-gradient(45deg,rgba(53,237,126,0.15) 0%,transparent 3%)}
.info-popup-header{display:flex;align-items:center;justify-content:space-between;padding:22px 28px 14px;
  border-bottom:1px solid rgba(53,237,126,0.22);
  background:linear-gradient(180deg,rgba(53,237,126,0.16),transparent);
  letter-spacing:0.5px}
.info-popup-title{font-family:'Handjet',var(--font-main),sans-serif;font-size:40px;font-weight:800;
  color:#35ed7e;letter-spacing:10px;text-transform:uppercase;
  text-shadow:0 0 16px rgba(53,237,126,0.65)}
.info-popup-close{width:42px;height:42px;border:1px solid rgba(53,237,126,0.4);border-radius:4px;
  background:rgba(0,0,0,0.35);color:rgba(53,237,126,0.85);cursor:pointer;font-size:20px;
  display:flex;align-items:center;justify-content:center;transition:all .15s}
.info-popup-close:hover{background:rgba(53,237,126,0.18);color:#35ed7e;border-color:#35ed7e}
.info-popup-body{padding:32px 30px 38px;font-family:'Handjet',var(--font-main),sans-serif;font-size:28px;font-weight:500;line-height:1.9;
  color:rgba(202,235,210,0.9);position:relative;z-index:1;letter-spacing:1px;overflow:auto}
.info-popup-body p{margin-bottom:22px}
.info-popup-body .info-strap{display:inline-flex;align-items:center;gap:12px;
  padding:10px 14px;border-radius:4px;border:1px solid rgba(53,237,126,0.5);
  background:linear-gradient(135deg,rgba(53,237,126,0.16),rgba(53,237,126,0.06));
  font-size:22px;font-weight:700;letter-spacing:3px;text-transform:uppercase;color:#35ed7e;
  box-shadow:0 0 14px rgba(53,237,126,0.2)}
.info-popup-body strong{color:#35ed7e;font-weight:700}
.info-popup-body .info-version{font-family:'Handjet',monospace;font-size:20px;color:rgba(53,237,126,0.7);
  letter-spacing:6px;margin-top:28px;display:block;text-transform:uppercase}
/* Grid lines inside popup */
.info-popup-body::before{content:'';position:absolute;inset:0;pointer-events:none;
  background:
    linear-gradient(rgba(53,237,126,0.025) 1px,transparent 1px) 0 0 / 32px 32px,
    linear-gradient(90deg,rgba(53,237,126,0.025) 1px,transparent 1px) 0 0 / 32px 32px,
    repeating-linear-gradient(0deg,rgba(53,237,126,0.05) 0px,rgba(53,237,126,0.05) 1px,transparent 1px,transparent 3px),
    repeating-linear-gradient(90deg,rgba(53,237,126,0.05) 0px,rgba(53,237,126,0.05) 1px,transparent 1px,transparent 3px);
  mix-blend-mode:screen}

/* FULLSCREEN MODE — panel hidden, screen fills entire viewport */
.tv-casing.fs-mode .tv-panel{display:none}
.tv-casing.fs-mode .tv-screen-area{top:0;bottom:0;left:0;right:0;border-radius:0;border:none;box-shadow:none;background:#000}
.tv-casing.fs-mode .tv-screen{top:0;bottom:0;left:0;right:0;border-radius:0}
.tv-casing.fs-mode{border-radius:0;border:none;box-shadow:none}
.tv-casing.fs-mode::after{display:none}
/* Fullscreen: zoom video to fill (cover letterbox) */
.tv-casing.fs-mode .yt-slot.yt-ready{position:absolute;top:-80px;left:-15px;width:calc(100% + 30px);height:calc(100% + 160px);transform:scale(1.25);object-fit:cover}
/* Fullscreen exit button — top right */
.fs-exit-btn{display:none;position:absolute;top:16px;right:20px;z-index:50;
  width:48px;height:48px;border-radius:50%;border:none;cursor:pointer;
  background:rgba(0,0,0,0.7);color:rgba(255,255,255,0.8);
  font-size:22px;font-weight:bold;
  backdrop-filter:blur(6px);
  box-shadow:0 2px 12px rgba(0,0,0,0.5),0 0 0 1px rgba(255,255,255,0.1);
  transition:all .2s;align-items:center;justify-content:center}
.fs-exit-btn:hover{background:rgba(255,68,68,0.5);color:#fff;transform:scale(1.1);
  box-shadow:0 2px 16px rgba(255,68,68,0.4),0 0 0 1px rgba(255,68,68,0.3)}
.tv-casing.fs-mode .fs-exit-btn{display:flex}
/* Fullscreen: wider SMS ticker */
.tv-casing.fs-mode .sms-ticker-screen{display:none}
.tv-casing.fs-mode .sms-item{font-size:28px;padding:0 40px}

/* RESPONSIVE */
@media(max-width:1100px){:root{--panel-w:300px}}
@media(max-width:900px){:root{--panel-w:260px}.tv-screen-area{top:10px;bottom:10px;left:10px;right:calc(var(--panel-w)+8px)}.tv-screen{top:9px;bottom:9px;left:9px;right:9px}.ch-btn{height:50px}}
@media(max-width:540px){:root{--panel-w:220px}.channel-grid{grid-template-columns:repeat(2,1fr)}.ch-btn{height:44px}.panel-logo-lom{font-size:20px}}

/* MOBILE — sākuma ekrāna logo samazināšana */
@media(max-width:540px){
  .logo-letter{font-size:120px !important}
  .logo-letter.logo-M{font-size:130px !important}
  .logo-o-sphere{width:100px;height:130px}
  .logo-tv{font-size:65px}
  .lomk-sub{font-size:18px}
  .start-btn{width:90px;height:90px;margin-top:24px}
  .start-btn .play-tri{border-width:20px 0 20px 35px}
  .start-btn-label{font-size:12px;bottom:-28px}
}
@media(max-width:400px){
  .logo-letter{font-size:80px !important}
  .logo-letter.logo-M{font-size:90px !important}
  .logo-o-sphere{width:70px;height:90px}
  .logo-tv{font-size:42px}
  .lomk-sub{font-size:15px;letter-spacing:3px}
  .start-btn{width:76px;height:76px;margin-top:18px}
  .start-btn .play-tri{border-width:16px 0 16px 28px}
  .start-sub{font-size:14px}
}

/* MOBILE LANDSCAPE — TV skats optimizēts */
@media(max-width:900px) and (orientation:landscape){
  :root{--panel-w:200px}
  .tv-screen-area{top:4px;bottom:4px;left:4px;right:calc(var(--panel-w)+4px)}
  .tv-screen{top:4px;bottom:4px;left:4px;right:4px}
  .tv-overlay{bottom:56px;left:8px;max-width:60%}
  .tv-overlay-inner{padding:10px 16px 8px}
  .tv-overlay-title{font-size:16px}
  .tv-overlay-artist{font-size:14px}
  .tv-overlay-label{font-size:14px;letter-spacing:3px;margin-bottom:4px}
  .sms-ticker-screen{height:40px}
  .sms-item{font-size:13px;padding:0 16px}
  .screen-progress{bottom:18px}
  .channel-grid{gap:3px;padding:4px}
  .ch-btn{height:32px;border-radius:5px}
  .ch-btn-front,.ch-btn-back{font-size:11px;letter-spacing:0.5px}
  .panel-logo-lom{font-size:14px}
  .controls-section{padding:2px 8px}
  .ctrl-btn{height:28px;font-size:11px}
  .ch-vertical-btn{min-height:60px;width:44px}
  .ch-vertical-btn-top,.ch-vertical-btn-bottom{font-size:18px}
  .ch-vertical-btn-center{font-size:12px}
  .power-top-row{gap:4px}
  .power-btn-horizontal{font-size:12px}
  .power-btn-horizontal .power-icon{font-size:16px}
  .panel-header-wrapper{padding:4px 8px}
  .panel-divider{margin:2px 0}
  .speaker-grille{display:none}
  .sms-panel{padding:4px}
  .sms-panel-row{gap:4px}
  .sms-send-btn{font-size:12px;padding:6px 8px}
  .sms-name-input{font-size:14px;padding:4px 6px}
  .sms-text-input{min-height:30px;font-size:13px;padding:4px 6px}
  .util-btns-bottom .wood-btn{height:36px;font-size:14px}
  .screen-logo{top:6px;left:8px;padding:6px 10px 6px 8px}
  .screen-logo-letter{font-size:18px}
  .screen-logo-o-sphere{width:14px;height:18px}
  .screen-logo-tv{font-size:10px}
}
@media(max-height:400px) and (orientation:landscape){
  .sms-ticker-screen{height:32px}
  .sms-item{font-size:11px;padding:0 12px}
  .tv-overlay{bottom:40px}
  .screen-progress{bottom:14px}
}

/* "PAGRIEZ TELEFONU" OVERLAY — tikai portrait mobilajā */
@keyframes rotatePhoneAnim{0%,100%{transform:rotate(0deg)}30%,70%{transform:rotate(-90deg)}}
.rotate-overlay{display:none;position:fixed;inset:0;z-index:500;background:#020808;
  flex-direction:column;align-items:center;justify-content:center;gap:16px;color:#fff;text-align:center;padding:20px}
.rotate-phone-icon{font-size:64px;animation:rotatePhoneAnim 3s ease-in-out infinite}
.rotate-text{font-family:'Russo One',var(--font-display),sans-serif;font-size:22px;color:var(--neon-purple);
  text-shadow:0 0 12px rgba(155,77,255,0.5)}
.rotate-sub{font-family:var(--font-main);font-size:14px;color:rgba(200,210,240,0.5);max-width:280px}
@media(max-width:768px) and (orientation:portrait){
  .rotate-overlay{display:flex !important}
  #app{display:none !important}
}

/* CIRCULAR VOLUME KNOB — Discord style */
@property --vc-pct{syntax:'<number>';inherits:false;initial-value:0.8}
.vol-circle-section{display:none}
.vol-circle-label{font-family:var(--font-main);font-size:18px;font-weight:700;letter-spacing:3px;color:rgba(224,227,255,0.25);text-transform:uppercase}
/* outer bezel ring */
.vc-bezel{position:relative;width:110px;height:110px;border-radius:50%;
  background:radial-gradient(circle at 35% 28%, rgba(88,101,242,0.12) 0%, transparent 55%),
             linear-gradient(145deg,rgba(25,23,92,0.6) 0%,rgba(5,5,15,0.9) 50%,rgba(10,9,26,0.8) 100%);
  box-shadow:0 4px 16px rgba(0,0,0,0.8),
             inset 0 1px 2px rgba(88,101,242,0.2),
             inset 0 -2px 4px rgba(0,0,0,0.7),
             0 0 0 1px rgba(88,101,242,0.15);
  display:flex;align-items:center;justify-content:center;cursor:pointer}
/* glass layer */
.vc-glass{position:absolute;inset:6px;border-radius:50%;
  background:radial-gradient(circle at 38% 32%, rgba(88,101,242,0.1) 0%, transparent 60%),
             rgba(5,5,15,0.85);
  filter:url(#vcTurb);
  overflow:hidden;pointer-events:none}
.vc-glass::after{content:'';position:absolute;inset:0;border-radius:50%;
  background:radial-gradient(circle at 40% 30%, rgba(88,101,242,0.08) 0%, transparent 65%)}
/* particle ring */
.vc-particles{position:absolute;inset:0;border-radius:50%;pointer-events:none;
  transition:opacity .2s}
.vc-particles::before{content:'';position:absolute;top:50%;left:50%;
  width:3px;height:3px;border-radius:50%;margin:-1.5px;
  background:transparent;
  box-shadow:
    -38px -14px 0 1px rgba(88,101,242,0),
    -33px -26px 0 1px rgba(88,101,242,0),
    -24px -34px 0 1px rgba(88,101,242,0),
    -12px -38px 0 1px rgba(88,101,242,0),
     0px  -39px 0 1px rgba(88,101,242,0),
     12px -38px 0 1px rgba(88,101,242,0),
     24px -34px 0 1px rgba(88,101,242,0),
     33px -26px 0 1px rgba(88,101,242,0),
     38px -14px 0 1px rgba(88,101,242,0);
  transition:box-shadow .12s ease}
.vc-bezel:active .vc-particles::before,
.vc-bezel.active .vc-particles::before{
  box-shadow:
    -48px -18px 0 2px rgba(88,101,242,0.9),
    -42px -34px 0 1px rgba(88,101,242,0.7),
    -30px -44px 0 2px rgba(224,227,255,0.8),
    -15px -49px 0 1px rgba(88,101,242,0.6),
     2px  -50px 0 2px rgba(88,101,242,0.85),
     17px -48px 0 1px rgba(224,227,255,0.7),
     31px -42px 0 2px rgba(88,101,242,0.75),
     42px -32px 0 1px rgba(88,101,242,0.65),
     49px -16px 0 2px rgba(224,227,255,0.8)}
.vc-wrap{position:relative;width:98px;height:98px;cursor:pointer}
.vc-svg{position:absolute;inset:0;width:100%;height:100%;overflow:visible;pointer-events:none}
/* outer diffused glow */
.vc-glow2{fill:none;stroke-linecap:round;stroke-width:18;
  stroke:rgba(88,101,242,0.12);
  stroke-dasharray:calc(var(--vc-pct,0.8)*220) 220;
  transition:stroke-dasharray 0.06s linear;
  filter:blur(6px)}
/* inner tight glow */
.vc-glow{fill:none;stroke-linecap:round;stroke-width:10;
  stroke:rgba(88,101,242,0.35);
  stroke-dasharray:calc(var(--vc-pct,0.8)*220) 220;
  transition:stroke-dasharray 0.06s linear;
  filter:blur(2.5px)}
/* dark track */
.vc-track{fill:none;stroke:rgba(224,227,255,0.08);stroke-width:6;stroke-linecap:round}
/* main arc */
.vc-arc{fill:none;stroke-linecap:round;stroke-width:6;
  stroke:url(#vcGrad);
  stroke-dasharray:calc(var(--vc-pct,0.8)*220) 220;
  transition:stroke-dasharray 0.06s linear}
/* center readout */
.vc-center{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);
  display:flex;flex-direction:column;align-items:center;line-height:1;pointer-events:none;gap:1px}
.vc-val{font-family:var(--font-display);font-size:29px;font-weight:900;
  color:var(--light-blurple);
  text-shadow:0 0 6px rgba(88,101,242,0.6),0 0 14px rgba(88,101,242,0.3)}
.vc-unit{font-family:var(--font-main);font-size:16px;font-weight:700;letter-spacing:3px;color:rgba(224,227,255,0.25);text-transform:uppercase}
/* rotating indicator tick */
.vc-dot{position:absolute;top:50%;left:50%;width:5px;height:5px;border-radius:50%;
  background:var(--blurple);
  box-shadow:0 0 5px 2px rgba(88,101,242,0.9),0 0 10px 4px rgba(88,101,242,0.5);
  transform-origin:0 0;pointer-events:none;
  translate:-2.5px calc(-39px)}
.vc-input{position:absolute;inset:-12px;width:calc(100% + 24px);height:calc(100% + 24px);
  opacity:0;cursor:pointer;-webkit-appearance:none;appearance:none;margin:0;
  border-radius:50%;z-index:10}

/* ====== SYNTHWAVE GAME CHANNEL ====== */
.game-slot{position:absolute;inset:0;z-index:6;overflow:hidden;background:#0a0014}
.sw-scene{position:absolute;inset:0;overflow:hidden}
/* Stars */
.sw-stars{position:absolute;inset:0;z-index:0}
.sw-star{position:absolute;width:2px;height:2px;border-radius:50%;background:#fff;opacity:0.6;
  animation:swStarTwinkle 3s ease-in-out infinite alternate}
@keyframes swStarTwinkle{0%{opacity:0.3;transform:scale(0.8)}100%{opacity:0.9;transform:scale(1.2)}}
/* Sun */
.sw-sun{position:absolute;bottom:38%;left:50%;transform:translateX(-50%);width:220px;height:220px;z-index:1;
  background:radial-gradient(circle,#ff2975 0%,#ff6b2b 30%,#f5a623 50%,transparent 70%);
  border-radius:50%;box-shadow:0 0 80px rgba(255,41,117,0.5),0 0 160px rgba(255,107,43,0.3);
  mask-image:linear-gradient(to bottom,#000 45%,transparent 45%,transparent 48%,#000 48%,#000 52%,transparent 52%,transparent 55%,#000 55%,#000 59%,transparent 59%,transparent 62%,#000 62%,#000 66%,transparent 66%,transparent 70%,#000 70%,#000 76%,transparent 76%,transparent 82%,#000 82%);
  -webkit-mask-image:linear-gradient(to bottom,#000 45%,transparent 45%,transparent 48%,#000 48%,#000 52%,transparent 52%,transparent 55%,#000 55%,#000 59%,transparent 59%,transparent 62%,#000 62%,#000 66%,transparent 66%,transparent 70%,#000 70%,#000 76%,transparent 76%,transparent 82%,#000 82%)}
/* Grid floor */
.sw-grid-wrap{position:absolute;bottom:0;left:-20%;width:140%;height:48%;z-index:2;overflow:hidden;
  perspective:300px;perspective-origin:50% 70%}
.sw-grid{position:absolute;inset:0;
  background:
    linear-gradient(rgba(155,77,255,0.4) 1px,transparent 1px) 0 0 / 80px 40px,
    linear-gradient(90deg,rgba(155,77,255,0.4) 1px,transparent 1px) 0 0 / 80px 40px;
  transform:rotateX(65deg) translateZ(0);transform-origin:center top;
  animation:swGridMove 1.5s linear infinite}
@keyframes swGridMove{0%{background-position:0 0,0 0}100%{background-position:0 40px,0 0}}
/* Road — 3 lanes */
.sw-road{position:absolute;bottom:0;left:50%;transform:translateX(-50%);width:0;height:48%;z-index:3;
  border-left:220px solid transparent;border-right:220px solid transparent;
  border-bottom:none;
  background:linear-gradient(to top,rgba(10,0,20,0.85),rgba(10,0,20,0.2));
  clip-path:polygon(35% 0%,65% 0%,85% 100%,15% 100%)}
.sw-lane{position:absolute;bottom:0;width:3px;height:100%;
  background:repeating-linear-gradient(to top,rgba(255,41,117,0.6) 0px,rgba(255,41,117,0.6) 20px,transparent 20px,transparent 40px)}
.sw-lane-l{position:absolute;bottom:0;left:38%;width:2px;height:48%;z-index:4;
  background:repeating-linear-gradient(to top,rgba(255,41,117,0.5) 0px,rgba(255,41,117,0.5) 15px,transparent 15px,transparent 30px)}
.sw-lane-r{position:absolute;bottom:0;left:62%;width:2px;height:48%;z-index:4;
  background:repeating-linear-gradient(to top,rgba(255,41,117,0.5) 0px,rgba(255,41,117,0.5) 15px,transparent 15px,transparent 30px)}
/* Car */
.sw-car{position:absolute;bottom:10%;left:50%;transform:translateX(-50%);z-index:10;
  width:60px;height:80px;transition:left 0.15s ease-out}
.sw-car::before{content:'';position:absolute;bottom:0;left:5px;width:50px;height:20px;
  background:linear-gradient(90deg,#ff2975,#9b4dff);border-radius:3px;
  box-shadow:0 0 20px rgba(255,41,117,0.8),0 0 40px rgba(155,77,255,0.4)}
.sw-car::after{content:'';position:absolute;bottom:18px;left:12px;width:36px;height:45px;
  background:linear-gradient(180deg,#19d0e8 0%,#1a1a2e 40%);
  clip-path:polygon(10% 100%,90% 100%,80% 30%,70% 0%,30% 0%,20% 30%);
  box-shadow:0 -4px 15px rgba(25,208,232,0.5)}
/* Car headlights */
.sw-car-lights{position:absolute;bottom:60px;left:50%;transform:translateX(-50%);width:70px;height:120px;z-index:9;
  background:linear-gradient(to top,rgba(25,208,232,0.3),transparent);
  clip-path:polygon(30% 100%,70% 100%,90% 0%,10% 0%);pointer-events:none;
  filter:blur(4px);opacity:0.6}
/* Obstacles */
.sw-obstacle{position:absolute;z-index:8;transition:none;pointer-events:none}
.sw-palm{width:40px;height:70px}
.sw-palm .sw-palm-trunk{position:absolute;bottom:0;left:50%;transform:translateX(-50%);
  width:8px;height:40px;background:linear-gradient(90deg,#4a2800,#6b3900,#4a2800);border-radius:2px}
.sw-palm .sw-palm-top{position:absolute;top:0;left:50%;transform:translateX(-50%);
  width:40px;height:35px;
  background:radial-gradient(ellipse at center bottom,#0a6e0a 0%,#0d9e0d 50%,transparent 70%);
  filter:drop-shadow(0 0 4px rgba(53,237,126,0.4))}
.sw-building{background:linear-gradient(180deg,#ff2975 0%,#9b4dff 50%,#1a1a2e 100%);
  border:1px solid rgba(155,77,255,0.5);position:relative}
.sw-building::before{content:'';position:absolute;inset:4px;
  background:repeating-linear-gradient(0deg,rgba(255,255,255,0.15) 0px,rgba(255,255,255,0.15) 6px,transparent 6px,transparent 12px);
  opacity:0.5}
.sw-mountain{clip-path:polygon(50% 0%,0% 100%,100% 100%);
  background:linear-gradient(180deg,#2a1a4e,#0a0014);
  border-bottom:2px solid rgba(155,77,255,0.4)}
/* Score */
.sw-score{position:absolute;top:16px;right:20px;z-index:15;
  font-family:'Handjet',var(--font-main),sans-serif;font-size:42px;font-weight:700;
  color:#35ed7e;letter-spacing:4px;
  text-shadow:0 0 16px rgba(53,237,126,0.7),0 0 32px rgba(53,237,126,0.3)}
.sw-score::before{content:'SCORE';display:block;font-size:16px;letter-spacing:6px;
  color:rgba(53,237,126,0.5);margin-bottom:2px}
/* LOM brand */
.sw-lom{position:absolute;top:16px;left:20px;z-index:15;
  font-family:'Russo One',var(--font-display),sans-serif;font-size:28px;
  color:var(--neon-purple);letter-spacing:8px;
  text-shadow:0 0 20px rgba(155,77,255,0.7),0 0 40px rgba(155,77,255,0.3)}
/* Bonus flash */
.sw-bonus{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);z-index:20;
  font-family:'Handjet',var(--font-main),sans-serif;font-size:60px;font-weight:700;
  color:#f5a623;letter-spacing:8px;
  text-shadow:0 0 20px rgba(245,166,35,0.8);
  animation:swBonusPop 0.8s ease-out forwards;pointer-events:none}
@keyframes swBonusPop{0%{opacity:1;transform:translate(-50%,-50%) scale(0.5)}50%{transform:translate(-50%,-50%) scale(1.2)}100%{opacity:0;transform:translate(-50%,-50%) scale(1.5) translateY(-30px)}}
/* Car hit flash */
@keyframes swCarHit{0%,100%{opacity:1}25%,75%{opacity:0.3}}
.sw-car.hit{animation:swCarHit 0.4s ease}
/* Mobile game controls */
.sw-touch-controls{position:absolute;bottom:0;left:0;right:0;height:50%;z-index:12;display:flex;pointer-events:auto}
.sw-touch-left,.sw-touch-right{flex:1;-webkit-tap-highlight-color:transparent}

/* ====== INFO POPUP TEXT HIGHLIGHT ====== */
.text-highlight{all:unset;
  background-repeat:no-repeat;background-size:0% 100%;
  background-image:linear-gradient(rgba(53,237,126,0.22),rgba(53,237,126,0.22));
  transition:color 0.4s ease,background-size 0.8s cubic-bezier(.25,1,.5,1);color:inherit}
.text-highlight.active{background-size:100% 100%;color:#35ed7e}
/* Info popup progress bar */
.info-popup-progress{position:sticky;top:0;left:0;width:100%;height:3px;z-index:10;
  background:rgba(53,237,126,0.12);flex-shrink:0}
.info-popup-progress-fill{height:100%;width:0%;
  background:linear-gradient(90deg,#35ed7e,#19d0e8);transition:width 0.15s linear}
/* Magic stars on popup title */
.info-popup-title{position:relative;display:inline-block}
.magic-star{--size:clamp(12px,1.2vw,18px);display:block;height:var(--size);width:var(--size);
  position:absolute;left:var(--star-left);top:var(--star-top);
  animation:starScale 700ms ease forwards;pointer-events:none}
.magic-star svg{animation:starRotate 1s linear infinite;display:block;opacity:0.7;width:100%;height:100%}
.magic-star svg path{fill:#35ed7e}
@keyframes starScale{from,to{transform:scale(0)}50%{transform:scale(1)}}
@keyframes starRotate{from{transform:rotate(0deg)}to{transform:rotate(180deg)}}
</style>
</head>
<body>

<!-- START -->
<div class="start-screen" id="startScreen">
  <div class="start-particles">
    <div class="start-particle"></div><div class="start-particle"></div><div class="start-particle"></div>
    <div class="start-particle"></div><div class="start-particle"></div><div class="start-particle"></div>
    <div class="start-particle"></div><div class="start-particle"></div><div class="start-particle"></div>
    <div class="start-particle"></div>
  </div>
  <div class="logo-container">
    <div class="logo-sub-wrap">
      <div class="logo-main">
        <span class="logo-letter logo-L">L</span><span class="logo-o-sphere"><span class="logo-sphere"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></span></span><span class="logo-letter logo-M">M</span><span class="logo-tv">tv</span>
      </div>
      <div class="lomk-sub">Latvijas Online Mūzikas Kanāls</div>
      <div class="start-sub">kopš 2003. gada</div>
    </div>
  </div>
  <button class="start-btn" id="startBtn" onclick="launchTV()">
    <div class="play-tri"></div>
    <span class="start-btn-label">play</span>
  </button>
</div>

<!-- CALIBRATION moved inside tv-screen -->

<!-- ROTATE PHONE OVERLAY (mobile portrait) -->
<div class="rotate-overlay" id="rotateOverlay">
  <div class="rotate-phone-icon">📱</div>
  <div class="rotate-text">Pagriez telefonu horizontāli</div>
  <div class="rotate-sub">LOM TV vislabāk skatāms landscape režīmā</div>
</div>

<!-- APP -->
<div id="app">
  <div class="tv-casing">

    <!-- SCREEN -->
    <div class="tv-screen-area">
      <div class="tv-screen" id="tvScreen">
        <div class="scanlines"></div>
        <div id="yt-slot-a" class="yt-slot"></div>
        <div id="yt-slot-b" class="yt-slot yt-hidden"></div>
        <!-- GAME CHANNEL SLOT -->
        <div id="game-slot" class="game-slot" style="display:none">
          <div class="sw-scene">
            <div class="sw-stars" id="swStars"></div>
            <div class="sw-sun"></div>
            <div class="sw-grid-wrap"><div class="sw-grid"></div></div>
            <div class="sw-lane-l"></div><div class="sw-lane-r"></div>
            <div class="sw-car" id="swCar">
              <div class="sw-car-lights"></div>
            </div>
            <div id="swObstacles"></div>
            <div class="sw-score" id="swScore">0</div>
            <div class="sw-lom">LOM</div>
            <div class="sw-touch-controls"><div class="sw-touch-left" id="swTouchL"></div><div class="sw-touch-right" id="swTouchR"></div></div>
          </div>
        </div>
        <div class="yt-blocker" id="ytBlocker"></div>
        <div class="yt-bottom-hide"></div>
        <div class="era-overlay-vintage"></div>
        <div class="era-overlay-vintage-grain"></div>
        <div class="era-overlay-vintage-lines"></div>
        <div class="era-overlay-vcr"></div>
        <div class="era-overlay-vcr-chroma"></div>
        <div class="era-overlay-vcr-band"></div>
        <div class="era-overlay-vcr-grain"></div>
        <div class="era-overlay-vcr-glitch"></div>
        <div class="screen-logo"><span class="screen-logo-l">L</span><span class="screen-logo-o-sphere"><span class="screen-logo-sphere"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></span></span><span class="screen-logo-m">M</span><span class="screen-logo-tv">tv</span></div>
        <button class="fs-exit-btn" id="fsExitBtn" onclick="toggleFullscreen()" title="Iziet no pilnekrāna">✕</button>
        <div class="ch-switch-overlay" id="chOverlay"></div>
        <div class="now-playing" id="nowPlaying">
          <div class="now-playing-text" id="npText">—</div>
          <div class="now-playing-ch" id="npCh">KAN 1</div>
        </div>
        <!-- TV Info Overlay (Now Playing / Up Next / Just Played) -->
        <div class="tv-overlay" id="tvOverlay">
          <div class="tv-overlay-inner">
            <div class="tv-overlay-label" id="tvOvLabel">TAGAD SKAN</div>
            <div class="tv-overlay-title" id="tvOvTitle">—</div>
            <div class="tv-overlay-artist" id="tvOvArtist">—</div>
            <div class="tv-overlay-meta" id="tvOvMeta"></div>
          </div>
        </div>
        <div class="screen-progress"><div class="screen-progress-fill" id="npProgressFill"></div></div>
        <div class="sms-ticker-screen"><div class="sms-ticker-inner" id="smsTicker"></div></div>
        <div class="static-noise" id="staticNoise"><canvas id="noiseCanvas"></canvas></div>
        <!-- Volume OSD -->
        <div class="vol-osd" id="volOsd">
          <div class="vol-osd-label">VOLUME</div>
          <div class="vol-osd-bar">
            <div class="vol-osd-blocks" id="volOsdBlocks"></div>
            <div class="vol-osd-dashes" id="volOsdDashes"></div>
          </div>
          <div class="vol-osd-value" id="volOsdValue">80</div>
        </div>
        <!-- Muted overlay -->
        <div class="mute-osd" id="muteOsd">
          <div class="mute-osd-icon">🔇</div>
          <div class="mute-osd-text">MUTED</div>
          <div class="mute-osd-sub">TAP TO UNMUTE</div>
        </div>
        <div class="power-off-screen" id="powerOff"><div class="power-dot"></div></div>
        <div class="calib-screen" id="calibScreen">
          <div class="calib-bars"><div class="calib-bar"></div><div class="calib-bar"></div><div class="calib-bar"></div><div class="calib-bar"></div><div class="calib-bar"></div><div class="calib-bar"></div><div class="calib-bar"></div><div class="calib-bar"></div></div>
          <div class="calib-bottom"><div class="calib-bottom-bar"></div><div class="calib-bottom-bar"></div><div class="calib-bottom-bar"></div><div class="calib-bottom-bar"></div><div class="calib-bottom-bar"></div><div class="calib-bottom-bar"></div><div class="calib-bottom-bar"></div><div class="calib-bottom-bar"></div></div>
        </div>
      </div>
    </div>

    <!-- PANEL -->
    <div class="tv-panel">
      <div class="panel-header-wrapper">
        <div class="panel-header">
          <div class="panel-header-top-row">
            <div class="power-top-row">
              <button class="power-btn-horizontal fullscreen" id="powerBtnHorizontal" onclick="togglePower()">
                <div class="btn-icon-wrap power-circle">
                  <span class="power-text" id="powerText">OFF</span>
                </div>
              </button>
              <button class="power-btn-horizontal fullscreen" id="fullscreenBtn" onclick="toggleFullscreen()">
                <div class="btn-icon-wrap full-square">
                  <span class="full-corner-tr"></span>
                  <span class="full-corner-bl"></span>
                  <span class="power-text">FULL</span>
                </div>
              </button>
            </div>
            <div class="indicator-bars">
              <div class="indicator-bar active"></div>
              <div class="indicator-bar active"></div>
              <div class="indicator-bar active"></div>
              <div class="indicator-bar"></div>
              <div class="indicator-bar"></div>
              <div class="indicator-bar"></div>
            </div>
            <div class="panel-led" id="ledPower"></div>
          </div>
          <div class="panel-divider"></div>
          <div class="controls-section">
          <div class="controls-3col">
            <div class="ctrl-col ctrl-col-left">
              <button class="ctrl-btn" id="muteBtn" onclick="toggleMute()">
                <span class="ctrl-label">MUTE</span>
              </button>
              <button class="ctrl-btn" id="volDownBtn" onclick="changeVolume(-5)">
                <span class="ctrl-arrow">◄</span>
                <span class="ctrl-label">VOL −</span>
              </button>
            </div>
            <div class="ctrl-col ctrl-col-center">
              <div class="ch-vertical-btn" id="chVerticalBtn">
                <div class="ch-vertical-btn-top" onclick="changeChannel(-1)" title="Iepriekšējais kanāls">▲</div>
                <div class="ch-vertical-btn-center">CH</div>
                <div class="ch-vertical-btn-bottom" onclick="changeChannel(1)" title="Nākošais kanāls">▼</div>
              </div>
            </div>
            <div class="ctrl-col ctrl-col-right">
              <button class="ctrl-btn" id="infoBtn" onclick="toggleInfoPopup()">
                <span class="ctrl-label">INFO</span>
              </button>
              <button class="ctrl-btn" id="volUpBtn" onclick="changeVolume(5)">
                <span class="ctrl-label">VOL +</span>
                <span class="ctrl-arrow">►</span>
              </button>
            </div>
          </div>
        </div>
      </div>
      <div class="channel-grid" id="channelGrid"><!-- Dinamiski ģenerēts no JS --></div>
      <div class="panel-divider"></div>
      <!-- Speaker grille fills remaining space -->
      <div class="speaker-grille" id="speakerGrille"></div>
      <div class="vol-circle-section" id="volCircleSection">
        <div class="vol-circle-label">Skaļums — podziņa</div>
        <div class="vc-wrap" id="vcWrap">
          <div class="vc-bezel">
            <div class="vc-glass"></div>
            <div class="vc-particles"></div>
          </div>
          <svg class="vc-svg" viewBox="0 0 100 100">
            <defs>
              <linearGradient id="vcGrad" x1="0%" y1="0%" x2="100%" y2="0%">
                <stop offset="0%" stop-color="#19175c"/>
                <stop offset="50%" stop-color="#5865f2"/>
                <stop offset="100%" stop-color="#e0e3ff"/>
              </linearGradient>
              <filter id="vcTurb">
                <feTurbulence type="fractalNoise" baseFrequency="0.015 0.15" numOctaves="5" seed="3"/>
              </filter>
            </defs>
            <!-- track: starts at -216deg (bottom-left), sweeps 252deg -->
            <circle class="vc-glow" cx="50" cy="50" r="35"
              transform="rotate(-216 50 50)"
              pathLength="220"/>
            <circle class="vc-track" cx="50" cy="50" r="35"
              transform="rotate(-216 50 50)"
              pathLength="220"/>
            <circle class="vc-arc" cx="50" cy="50" r="35"
              transform="rotate(-216 50 50)"
              pathLength="220"/>
          </svg>
          <div class="vc-center">
            <span class="vc-val" id="vcVal">80</span>
            <span class="vc-unit">VOL</span>
          </div>
          <div class="vc-dot" id="vcDot"></div>
          <input type="range" class="vc-input" id="vcInput" min="0" max="100" value="80">
        </div>
      </div>
      <div class="panel-bottom-zone">
        <div class="sms-panel" id="smsPanel">
          <div class="sms-panel-row">
            <button class="sms-send-btn" id="smsSendBtn" onclick="sendSMS()">SŪTĪT SMS</button>
            <input type="text" class="sms-name-input" id="smsName" placeholder="Tavs vārds" maxlength="15">
          </div>
          <textarea class="sms-text-input" id="smsText" placeholder="Tava ziņa..." maxlength="280" rows="2"></textarea>
        </div>
        <div class="util-btns-bottom">
          <button class="wood-btn" onclick="shareApp()"><span>📤</span> Dalīties</button>
        </div>
      </div>
    </div>

  </div>
</div>

<!-- INFO POPUP -->
<div class="info-popup-overlay" id="infoOverlay" onclick="if(event.target===this)toggleInfoPopup()">
  <div class="info-popup">
    <div class="info-popup-header">
      <span class="info-popup-title" id="infoTitle">/// SYS.INFO _
        <span class="magic-star"><svg viewBox="0 0 512 512"><path d="M512 255.1c0 11.34-7.406 20.86-18.44 23.64l-171.3 42.78l-42.78 171.1C276.7 504.6 267.2 512 255.9 512s-20.84-7.406-23.62-18.44l-42.66-171.2L18.47 279.6C7.406 276.8 0 267.3 0 255.1c0-11.34 7.406-20.83 18.44-23.61l171.2-42.78l42.78-171.1C235.2 7.406 244.7 0 256 0s20.84 7.406 23.62 18.44l42.78 171.2l171.2 42.78C504.6 235.2 512 244.6 512 255.1z"/></svg></span>
        <span class="magic-star"><svg viewBox="0 0 512 512"><path d="M512 255.1c0 11.34-7.406 20.86-18.44 23.64l-171.3 42.78l-42.78 171.1C276.7 504.6 267.2 512 255.9 512s-20.84-7.406-23.62-18.44l-42.66-171.2L18.47 279.6C7.406 276.8 0 267.3 0 255.1c0-11.34 7.406-20.83 18.44-23.61l171.2-42.78l42.78-171.1C235.2 7.406 244.7 0 256 0s20.84 7.406 23.62 18.44l42.78 171.2l171.2 42.78C504.6 235.2 512 244.6 512 255.1z"/></svg></span>
        <span class="magic-star"><svg viewBox="0 0 512 512"><path d="M512 255.1c0 11.34-7.406 20.86-18.44 23.64l-171.3 42.78l-42.78 171.1C276.7 504.6 267.2 512 255.9 512s-20.84-7.406-23.62-18.44l-42.66-171.2L18.47 279.6C7.406 276.8 0 267.3 0 255.1c0-11.34 7.406-20.83 18.44-23.61l171.2-42.78l42.78-171.1C235.2 7.406 244.7 0 256 0s20.84 7.406 23.62 18.44l42.78 171.2l171.2 42.78C504.6 235.2 512 244.6 512 255.1z"/></svg></span>
      </span>
      <button class="info-popup-close" onclick="toggleInfoPopup()">✕</button>
    </div>
    <div class="info-popup-body" id="infoBody">
      <div class="info-popup-progress"><div class="info-popup-progress-fill" id="infoProgressFill"></div></div>
      <div class="info-strap">ON AIR — LOM TV Paziņojums</div>
      <p><strong>LOM TV</strong> — <mark class="text-highlight">Latvijas Online Mūzikas</mark> Kanāls.</p>
      <p>Retro televīzijas formātā vari baudīt <mark class="text-highlight">labāko latviešu un ārzemju</mark> mūziku — no klasiskiem šlāgeriem līdz jaunākajiem hitiem. Sākam ar POP, ROKS un RETRO, bet vienmēr var pārslēgties uz ko košāku.</p>
      <p>Kanālu pārslēgšana, SMS rindas un dalīšanās pogas ir veidotas kā <mark class="text-highlight">TV paziņojumi</mark>, lai sajūta būtu tieši kā pie ekrāna: spied MUTE, VOL vai CH, un pamanīsi spilgtus ziņojumus, kas iegrimst fonā, bet <mark class="text-highlight">paliek skaidri salasāmi</mark>.</p>
      <p>Ja kas nestrādā vai vēlies ieteikumus nākamajai laidienai, <mark class="text-highlight">dod ziņu</mark> — uzturam ēteru kopā.</p>
      <span class="info-version">/// ver 2.0 — kopš 2003 _</span>
    </div>
  </div>
</div>

<script>
// ===== GOOGLE SHEETS CMS =====
// Tabulas formāts: YouTube ID | Izpildītājs | Dziesma | Albums | Gads | Garums (sek) | Era | Trim Start | Trim End | POP | ROKS | ŠLĀGERI | RETRO | ĀRZEMJU | 2020+ | HIPHOP | KONKURSI | LIVE | BĒRNI
// Publicē tabulu: File → Share → Publish to web → Sheet1 → CSV
// Ielīmē URL zemāk:
const SHEETS_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vT22_gZFH84iXiOMqKCi_ozUAlvU7ovMAH6rvZfwjEV8Dwqkn4lhzZsL4zMwyLGbZe7hS8Mgdw82C3E/pub?gid=0&single=true&output=csv';

// Kanālu konfigurācija (secība, nosaukumi, krāsas)
// csvPrefix — kolonnas nosaukuma sākums, pēc kura meklē CSV headerī
const CHANNEL_CONFIG = [
  // 14 kanāli: 8 pēc stila + 1 ārzemju + 3 pēc gada + 1 spēle + 1 klasika
  {key:'POP',     name:'POP',     label:'Pop',              color:'#9b4dff',  icon:'🎵', csvPrefix:'POP'},
  {key:'ROKS',    name:'ROKS',    label:'Roks',             color:'#19d0e8',  icon:'🎸', csvPrefix:'SMAGAIS'},
  {key:'ŠLĀGERI', name:'ŠLĀGERI', label:'Šlāgeri',         color:'#ff4cd2',  icon:'🎶', csvPrefix:'ŠLĀGERIS'},
  {key:'RAP',     name:'RAP',     label:'Rap',              color:'#ff66ff',  icon:'🎤', csvPrefix:'HIPHOP'},
  {key:'JAZZ',    name:'JAZZ',    label:'Jazz',             color:'#f5a623',  icon:'🎷', csvPrefix:'JAZZ'},
  {key:'DANCE',   name:'DANCE',   label:'Dance',            color:'#00e5ff',  icon:'💃', csvPrefix:'DEJU'},
  {key:'LIVE',    name:'LIVE',    label:'Live & EV',        color:'#e53935',  icon:'🎬', csvPrefix:'LIVE'},
  {key:'BĒRNI',   name:'BĒRNI',   label:'Bērni',            color:'#ffdd57',  icon:'🧸', csvPrefix:'BĒRNU'},
  {key:'ĀRZ',     name:'ĀRZ',     label:'Ārzemju',          color:'#c0c0c0',  icon:'🌍', csvPrefix:'ĀRZEMJU'},
  // Gada kanāli (automātiski pēc gada)
  {key:'RETRO',   name:'RETRO',   label:'Retro',            color:'#35ed7e',  icon:'📻', csvPrefix:'RETRO'},   // līdz 1990
  {key:'ATMODA',  name:'ATMODA',  label:'Atmoda',           color:'#ff8a65',  icon:'🌅', csvPrefix:'_ATMODA'},  // 1991-2021
  {key:'JAUNUMI', name:'JAUNUMI', label:'Jaunumi',          color:'#7a2ed9',  icon:'🔥', csvPrefix:'JAUNUMI'},  // 2022+
  // Spēle + Klasika
  {key:'SPĒLE',   name:'SPĒLE',   label:'Spēle',            color:'#ff2975',  icon:'🎮', type:'game'},
  {key:'KLASIKA', name:'KLASIKA', label:'Klasika',           color:'#d4af37',  icon:'🎻', csvPrefix:'KLASIKA'}
];

// Fallback dati (izmanto, ja Google Sheets nav pieejams)
// Fallback dati (izmanto, ja Google Sheets nav pieejams)
const FALLBACK_CHANNELS=[
  {name:'POP',label:'Pop',color:'#9b4dff',videos:[
    {id:'J-CmEbXH90M',title:'BrainStorm — Maybe',artist:'BrainStorm',song:'Maybe',decade:'modern',duration:205},
    {id:'p8FNO0DtBng',title:'Dons — Hollow',artist:'Dons',song:'Hollow',decade:'modern',duration:215}
  ]},
  {name:'ROKS',label:'Roks',color:'#19d0e8',videos:[
    {id:'lbeR6Tr_guI',title:'Jumprava — Vēlreiz',artist:'Jumprava',song:'Vēlreiz',decade:'vcr',duration:240}
  ]},
  {name:'RETRO',label:'Retro (līdz 1989)',color:'#35ed7e',videos:[
    {id:'jqUTbDiuN_M',title:'Čikāgas Piecīši — Pazudušais Dēls',artist:'Čikāgas Piecīši',song:'Pazudušais Dēls',decade:'vintage',duration:195}
  ]},
  {name:'ATMODA',label:'Atmoda (1990-2019)',color:'#ff8a65',videos:[
    {id:'LWLozvyMwhY',title:'BrainStorm — Feels',artist:'BrainStorm',song:'Feels',decade:'modern',duration:230}
  ]},
  {name:'JAUNUMI',label:'Jaunumi (2020+)',color:'#7a2ed9',videos:[
    {id:'Z0ZTfUM2-9w',title:'Arvis Reiks — Thinkin Bout You',artist:'Arvis Reiks',song:'Thinkin Bout You',decade:'modern',duration:200}
  ]}
];

// CSV parsēšana
function parseCSV(text){
  const lines=text.split('\n').filter(l=>l.trim());
  if(lines.length<2)return[];
  const headers=parseCSVLine(lines[0]).map(h=>h.trim());
  const rows=[];
  for(let i=1;i<lines.length;i++){
    const vals=parseCSVLine(lines[i]);
    const row={};
    headers.forEach((h,j)=>{row[h]=vals[j]?.trim()||''});
    rows.push(row);
  }
  return rows;
}
function parseCSVLine(line){
  const result=[];let current='';let inQuotes=false;
  for(let i=0;i<line.length;i++){
    const c=line[i];
    if(c==='"'){if(inQuotes&&line[i+1]==='"'){current+='"';i++}else{inQuotes=!inQuotes}}
    else if(c===','&&!inQuotes){result.push(current);current=''}
    else{current+=c}
  }
  result.push(current);
  return result;
}

// Sheets datu pārveidošana par channels masīvu
// CSV kolonnu nosaukumi ir gari ("POP, POP-ROKS, DISCO" utt.)
// Meklējam pēc prefiksa un arī piešķiram pēc gada (RETRO/ATMODA/JAUNUMI)
function findCSVColumn(headers,prefix){
  if(prefix.startsWith('_'))return null; // _ATMODA = nav CSV kolonna, aprēķina pēc gada
  return headers.find(h=>h.toUpperCase().startsWith(prefix.toUpperCase()))||null;
}
// Papildu CSV kolonnas kas mapējas uz mūsu kanāliem
const EXTRA_CSV_MAP=[
  // EV / Konkursi → LIVE
  {csvPrefix:'DZIESMU',     targetKey:'LIVE'},
  // Folk, Etno, Akadēmiskā → JAZZ
  {csvPrefix:'FOLK',        targetKey:'JAZZ'},
  {csvPrefix:'Akadēmiskā',  targetKey:'JAZZ'},
  // Regejs, Ska → ROKS
  {csvPrefix:'REGEJS',      targetKey:'ROKS'},
  // Electro, EDM, Latin → DANCE
  {csvPrefix:'ELECTRO',     targetKey:'DANCE'},
  {csvPrefix:'EDM',         targetKey:'DANCE'},
  {csvPrefix:'LATĪŅ',       targetKey:'DANCE'},
  // Blues, Ambient, Klasiskā → JAZZ
  {csvPrefix:'BLUES',       targetKey:'JAZZ'},
  {csvPrefix:'AMBIENT',     targetKey:'JAZZ'},
  {csvPrefix:'KLASISK',     targetKey:'JAZZ'},
];
function sheetsToChannels(rows){
  if(!rows||rows.length===0)return[];
  // Atrast visus CSV header nosaukumus
  const headers=Object.keys(rows[0]);
  // Izveidot mapping: kanāla key → CSV kolonnas nosaukums
  const colMap={};
  CHANNEL_CONFIG.forEach(cfg=>{
    const col=findCSVColumn(headers,cfg.csvPrefix);
    if(col)colMap[cfg.key]=col;
  });
  // Extra CSV kolonnas
  const extraCols=[];
  EXTRA_CSV_MAP.forEach(m=>{
    const col=headers.find(h=>h.toUpperCase().startsWith(m.csvPrefix.toUpperCase()));
    if(col)extraCols.push({col,targetKey:m.targetKey});
  });
  // Inicializēt kanālu map
  const channelMap={};
  CHANNEL_CONFIG.forEach(cfg=>{channelMap[cfg.key]={name:cfg.name,label:cfg.label,color:cfg.color,videos:[]}});
  // Apstrādāt katru rindu
  rows.forEach(row=>{
    const id=row['YouTube ID']||row['youtube_id']||'';
    if(!id)return;
    const artist=row['Izpildītājs']||row['artist']||'';
    const song=row['Dziesma']||row['song']||'';
    const album=row['Albums']||row['album']||'';
    const year=parseInt(row['Gads']||row['year'])||0;
    const duration=parseInt(row['Garums']||row['duration'])||240;
    const trimStart=parseInt(row['Trim Start']||row['trim_start'])||5;
    const trimEnd=parseInt(row['Trim End']||row['trim_end'])||10;
    // Era automātiski pēc gada: ≤1989=vintage, 1990-2000=vcr, 2001+=modern
    const era=year>0?(year<=1989?'vintage':year<=2000?'vcr':'modern'):'modern';
    const video={id,title:artist+' — '+song,artist,song,album,year,decade:era,duration,trimStart,trimEnd};
    const addedTo=new Set();
    // 1) Pārbaudīt tiešās CSV kolonnas (X atzīmes)
    CHANNEL_CONFIG.forEach(cfg=>{
      const col=colMap[cfg.key];
      if(!col)return;
      const val=(row[col]||'').trim().toUpperCase();
      if(val==='X'||val==='1'||val==='TRUE'){
        channelMap[cfg.key].videos.push(video);
        addedTo.add(cfg.key);
      }
    });
    // 2) Extra kolonnas (FOLK→JAZZ, REGEJS→ROKS, Akadēmiskā→JAZZ, ELECTRO→DANCE)
    extraCols.forEach(ec=>{
      const val=(row[ec.col]||'').trim().toUpperCase();
      if((val==='X'||val==='1'||val==='TRUE')&&!addedTo.has(ec.targetKey)){
        channelMap[ec.targetKey].videos.push(video);
        addedTo.add(ec.targetKey);
      }
    });
    // 3) Automātiski pēc gada: RETRO / ATMODA / JAUNUMI
    if(year>0){
      if(year<=1990&&!addedTo.has('RETRO')){channelMap['RETRO'].videos.push(video);addedTo.add('RETRO')}
      if(year>=1991&&year<=2021&&!addedTo.has('ATMODA')){channelMap['ATMODA'].videos.push(video);addedTo.add('ATMODA')}
      if(year>=2022&&!addedTo.has('JAUNUMI')){channelMap['JAUNUMI'].videos.push(video);addedTo.add('JAUNUMI')}
    }
  });
  // Filtrē tukšos kanālus (bet saglabā game kanālus)
  return CHANNEL_CONFIG.map((cfg,i)=>{
    const ch=channelMap[cfg.key];
    if(cfg.type==='game'){ch._isGame=true;ch.videos=[{id:'_game_',title:'Synthwave Racer',artist:'LOM',song:'Game',duration:9999}]}
    return ch;
  }).filter(ch=>ch.videos.length>0||ch._isGame);
}

// Ielādē datus no Google Sheets vai izmanto fallback
let channels=FALLBACK_CHANNELS;
let cmsLoaded=false;

async function loadFromSheets(){
  if(!SHEETS_CSV_URL)return false;
  try{
    const resp=await fetch(SHEETS_CSV_URL);
    if(!resp.ok)return false;
    const text=await resp.text();
    const rows=parseCSV(text);
    if(rows.length===0)return false;
    const parsed=sheetsToChannels(rows);
    if(parsed.length>0){channels=parsed;cmsLoaded=true;console.log('CMS: Ielādētas',rows.length,'dziesmas no Google Sheets');return true}
    return false;
  }catch(e){console.warn('CMS: Google Sheets nav pieejams, izmanto fallback',e);return false}
}

let currentChannel=0,currentVideoIdx={},isPoweredOn=true,player=null,playerReady=false,smsMessages=[],progressInterval=null,isMuted=false,currentVolume=80,volumeBeforeMute=80;
// Dual-player crossfade sistēma
let playerA=null,playerB=null,playerAReady=false,playerBReady=false;
let activeSlot='a'; // 'a' vai 'b' — kurš player pašlaik ir aktīvs
let crossfading=false,crossfadeTimer=null;
const CROSSFADE_DURATION=4000; // 4 sek crossfade — abi skan paralēli
let preloadedVideoId=null; // video ID kas jau ir ielādēts otrajā slotā

// ═══════════════════════════════════════
// PSEUDO-LIVE: Visi lietotāji dzird to pašu dziesmu vienlaicīgi
// ═══════════════════════════════════════
// Katram kanālam: efektīvais garums = duration - trimStart - trimEnd
// Unix timestamp % totalDuration → pozīcija playlistā → dziesma + seekTo
function getEffectiveDuration(v){return Math.max(30,(v.duration||240)-(v.trimStart||5)-(v.trimEnd||10))}
function getChannelTotalDuration(chIdx){
  return channels[chIdx].videos.reduce((sum,v)=>sum+getEffectiveDuration(v),0);
}
// Aprēķina kura dziesma skan un kurā sekundē — determinisms no timestamp
function getLivePosition(chIdx){
  const vids=channels[chIdx].videos;
  if(!vids||vids.length===0)return{videoIdx:0,seekTo:0};
  const total=getChannelTotalDuration(chIdx);
  const now=Math.floor(Date.now()/1000);
  let pos=now%total;
  for(let i=0;i<vids.length;i++){
    const eDur=getEffectiveDuration(vids[i]);
    if(pos<eDur)return{videoIdx:i,seekTo:pos+(vids[i].trimStart||5)};
    pos-=eDur;
  }
  return{videoIdx:0,seekTo:vids[0].trimStart||5};
}
// Inicializē visus kanālus uz pseudo-live pozīciju
function syncAllChannels(){
  channels.forEach((ch,i)=>{
    const live=getLivePosition(i);
    currentVideoIdx[i]=live.videoIdx;
  });
}
syncAllChannels();

// Dinamiski ģenerēt kanālu pogas no CHANNEL_CONFIG
function buildChannelGrid(){
  const grid=document.getElementById('channelGrid');
  grid.innerHTML='';
  channels.forEach((ch,i)=>{
    // Atrast atbilstošo CHANNEL_CONFIG ierakstu
    const cfg=CHANNEL_CONFIG.find(c=>c.name===ch.name)||{icon:'📺',name:ch.name};
    const active=i===0?' active':'';
    grid.innerHTML+=`<button class="ch-btn${active}" data-ch="${i}"><div class="ch-flipdisc"><div class="ch-face ch-face-front"><span class="ch-icon">${cfg.icon}</span><span class="ch-name">${ch.name}</span></div><div class="ch-face ch-face-back"><span class="ch-icon">${cfg.icon}</span><span class="ch-name">${ch.name}</span></div></div></button>`;
  });
}
buildChannelGrid();

function fireConfetti(){
  const container=document.createElement('div');container.className='confetti-container';document.body.appendChild(container);
  const colors=['#9b4dff','#19d0e8','#ff4cd2','#35ed7e','#ffdd57','#ff6b6b','#fff','#b366ff','#00e5ff'];
  const shapes=['circle','square','strip'];
  for(let i=0;i<150;i++){
    const c=document.createElement('div');c.className='confetti';
    const color=colors[Math.floor(Math.random()*colors.length)];
    const shape=shapes[Math.floor(Math.random()*shapes.length)];
    const size=4+Math.random()*12;
    c.style.left=(5+Math.random()*90)+'%';
    c.style.top=(20+Math.random()*30)+'%';
    c.style.width=shape==='strip'?size/3+'px':size+'px';
    c.style.height=shape==='strip'?size*2.5+'px':size+'px';
    c.style.background=color;
    c.style.borderRadius=shape==='circle'?'50%':shape==='strip'?'2px':'0';
    c.style.animationDelay=(Math.random()*0.3)+'s';
    c.style.animationDuration=(0.8+Math.random()*1)+'s';
    container.appendChild(c);
  }
  setTimeout(()=>container.remove(),2000);
}
function launchTV(){startTV()}
function startTV(){
  if(startTV._started)return;startTV._started=true;
  const ss=document.getElementById('startScreen');
  ss.classList.add('fade-out');
  setTimeout(()=>{
    ss.classList.add('hidden');
    document.getElementById('app').style.display='block';
    isPoweredOn=true;
    document.getElementById('powerBtnHorizontal').classList.add('active');
    const pt=document.getElementById('powerText');if(pt)pt.textContent='OFF';
    document.getElementById('ledPower').classList.remove('off');
    document.querySelectorAll('.indicator-bar').forEach(b=>b.classList.add('active'));
    // Uzreiz sāk atskaņot — bez kalibrācijas joslām
    initYTPlayer();initSMS();startProgressTracker();
  },600);
}
// Ielādē CMS datus sākuma ekrāna laikā, tad startē TV
loadFromSheets().then(loaded=>{
  if(loaded){
    syncAllChannels();
    buildChannelGrid();
  }
});
// TV startē tikai ar pogu klikšķi (nodrošina autoplay ar skaņu)

function initYTPlayer(){const tag=document.createElement('script');tag.src='https://www.youtube.com/iframe_api';document.head.appendChild(tag)}
const YT_VARS={autoplay:1,controls:0,disablekb:1,fs:0,modestbranding:1,rel:0,showinfo:0,iv_load_policy:3,cc_load_policy:0,playsinline:1,origin:location.origin};
function setupSlot(p,slot){
  try{p.getIframe().classList.add('yt-ready')}catch(ex){}
  try{p.loadModule('captions');p.unloadModule('captions')}catch(ex){}
}
window.onYouTubeIframeAPIReady=function(){
  // Pseudo-live: aprēķina kur šobrīd ir kanāls
  const live=getLivePosition(currentChannel);
  currentVideoIdx[currentChannel]=live.videoIdx;
  const v=channels[currentChannel].videos[live.videoIdx];
  const trimE=v.trimEnd||10,dur=v.duration||0;
  // Slot A — pirmais aktīvais player, seekTo uz live pozīciju
  playerA=new YT.Player('yt-slot-a',{
    videoId:v.id,
    playerVars:{...YT_VARS,start:live.seekTo,end:dur>trimE?dur-trimE:undefined},
    events:{
      onReady:(e)=>{playerAReady=true;playerReady=true;player=playerA;activeSlot='a';
        e.target.playVideo();updateNowPlaying();setVolume(80);setupSlot(playerA,'a');
      },
      onStateChange:(e)=>{
        if(activeSlot==='a'){
          if(e.data===YT.PlayerState.ENDED&&!crossfading)nextVideo();
          if(e.data===YT.PlayerState.PLAYING){document.getElementById('ledPower').classList.remove('off');try{playerA.unloadModule('captions')}catch(ex){}}
          if(e.data===YT.PlayerState.PAUSED&&isPoweredOn&&!crossfading){setTimeout(()=>{try{playerA.playVideo()}catch(ex){}},1500)}
        }
      }
    }
  });
  // Slot B — otrs player priekš crossfade
  playerB=new YT.Player('yt-slot-b',{
    playerVars:{...YT_VARS},
    events:{
      onReady:(e)=>{playerBReady=true;setupSlot(playerB,'b')},
      onStateChange:(e)=>{
        if(activeSlot==='b'){
          if(e.data===YT.PlayerState.ENDED&&!crossfading)nextVideo();
          if(e.data===YT.PlayerState.PLAYING){document.getElementById('ledPower').classList.remove('off');try{playerB.unloadModule('captions')}catch(ex){}}
          if(e.data===YT.PlayerState.PAUSED&&isPoweredOn&&!crossfading){setTimeout(()=>{try{playerB.playVideo()}catch(ex){}},1500)}
        }
      }
    }
  });
};

// Preload nākamo dziesmu otrajā playerī (muted)
function preloadNext(){
  if(crossfading)return;
  const nextV=getNextVideoInfo();
  if(!nextV||preloadedVideoId===nextV.id)return;
  const nextSlot=activeSlot==='a'?'b':'a';
  const nextPlayer=nextSlot==='a'?playerA:playerB;
  const nextReady=nextSlot==='a'?playerAReady:playerBReady;
  if(!nextPlayer||!nextReady)return;
  const trimS=nextV.trimStart||5,trimE=nextV.trimEnd||10,dur=nextV.duration||0;
  const opts={videoId:nextV.id,startSeconds:trimS};
  if(dur>trimE)opts.endSeconds=dur-trimE;
  try{
    nextPlayer.mute();
    nextPlayer.setVolume(0);
    nextPlayer.loadVideoById(opts);
    preloadedVideoId=nextV.id;
    console.log('Preload:',nextV.title);
  }catch(e){}
}
function crossfadeTo(v){
  if(!playerReady)return;
  if(crossfading)return;
  crossfading=true;
  const trimS=v.trimStart||5,trimE=v.trimEnd||10,dur=v.duration||0;
  const opts={videoId:v.id,startSeconds:trimS};
  if(dur>trimE)opts.endSeconds=dur-trimE;
  // Kurš ir nākamais slots?
  const nextSlot=activeSlot==='a'?'b':'a';
  const nextPlayer=nextSlot==='a'?playerA:playerB;
  const currPlayer=activeSlot==='a'?playerA:playerB;
  const nextEl=document.getElementById('yt-slot-'+nextSlot);
  const currEl=document.getElementById('yt-slot-'+activeSlot);
  // Ja video jau ir preloaded — nav jāielādē no jauna, tikai seeko uz sākumu
  if(preloadedVideoId===v.id){
    try{nextPlayer.seekTo(trimS,true)}catch(e){}
  }else{
    nextPlayer.loadVideoById(opts);
  }
  preloadedVideoId=null;
  nextPlayer.setVolume(0);
  nextPlayer.unMute();
  // Rādi nākamo slotu (vēl caurspīdīgs)
  nextEl.classList.remove('yt-hidden');
  // Volume fade: curr (pre-faded)→0, next 0→full pa CROSSFADE_DURATION
  const steps=20,interval=CROSSFADE_DURATION/steps;
  let step=0;
  const vol=isMuted?0:currentVolume;
  // Nolasīt faktisko volume (var būt samazināts ar pre-fade)
  let currVol=vol;
  try{currVol=currPlayer.getVolume()||vol}catch(e){}
  clearInterval(crossfadeTimer);
  crossfadeTimer=setInterval(()=>{
    step++;
    const pct=step/steps;
    // Smooth crossfade: abi vienlaicīgi, vidū abi ~70%
    const fadeOutVol=Math.round(currVol*Math.cos(pct*Math.PI/2));
    const fadeInVol=Math.round(vol*Math.sin(pct*Math.PI/2));
    try{currPlayer.setVolume(fadeOutVol)}catch(e){}
    try{nextPlayer.setVolume(fadeInVol)}catch(e){}
    // CSS opacity: pakāpenisks, ne uzreiz
    if(step===Math.round(steps*0.3))currEl.classList.add('yt-hidden');
    if(step>=steps){
      clearInterval(crossfadeTimer);
      try{currPlayer.pauseVideo()}catch(e){}
      activeSlot=nextSlot;
      player=nextPlayer;
      crossfading=false;
      try{nextPlayer.setVolume(vol)}catch(e){}
    }
  },interval);
  updateNowPlaying();resetOverlayPhases();
}
function playVideo(v){crossfadeTo(v)}
function playVideoLive(v,seekTo){
  // Bez crossfade, ar seekTo uz pseudo-live pozīciju
  if(!playerReady)return;
  crossfading=false;clearInterval(crossfadeTimer);preloadedVideoId=null;
  const trimE=v.trimEnd||10,dur=v.duration||0;
  const opts={videoId:v.id,startSeconds:seekTo};
  if(dur>trimE)opts.endSeconds=dur-trimE;
  const currPlayer=activeSlot==='a'?playerA:playerB;
  currPlayer.loadVideoById(opts);
  const vol=isMuted?0:currentVolume;
  try{currPlayer.setVolume(vol)}catch(e){}
  updateNowPlaying();resetOverlayPhases();
}
function playVideoHard(v){
  // Bez crossfade — tūlītēja pārslēgšana (kanāla maiņa ar static)
  if(!playerReady)return;
  crossfading=false;clearInterval(crossfadeTimer);preloadedVideoId=null;
  const trimS=v.trimStart||5,trimE=v.trimEnd||10,dur=v.duration||0;
  const opts={videoId:v.id,startSeconds:trimS};
  if(dur>trimE)opts.endSeconds=dur-trimE;
  const currPlayer=activeSlot==='a'?playerA:playerB;
  currPlayer.loadVideoById(opts);
  const vol=isMuted?0:currentVolume;
  try{currPlayer.setVolume(vol)}catch(e){}
  updateNowPlaying();resetOverlayPhases();
}
function getCurrentVideo(){return channels[currentChannel].videos[currentVideoIdx[currentChannel]]}
function nextVideo(){
  const ch=currentChannel;
  // Pseudo-live: nākamā dziesma pēc kārtas (crossfade brīdī tā jau ir pareizā)
  currentVideoIdx[ch]=(currentVideoIdx[ch]+1)%channels[ch].videos.length;
  crossfadeTo(channels[ch].videos[currentVideoIdx[ch]]);
}
function prevVideo(){
  // Prev nav pseudo-live — vienkārši iepriekšējā dziesma
  const ch=currentChannel;
  currentVideoIdx[ch]=(currentVideoIdx[ch]-1+channels[ch].videos.length)%channels[ch].videos.length;
  const v=channels[ch].videos[currentVideoIdx[ch]];
  crossfadeTo(v);
}
function getNextVideoInfo(){
  const ch=currentChannel,nextIdx=(currentVideoIdx[ch]+1)%channels[ch].videos.length;
  return channels[ch].videos[nextIdx];
}
function parseVideoMeta(v){
  // Parse "Artist — Title" format, or just use title
  const parts=v.title.split(' — ');
  if(parts.length>=2)return{artist:parts[0].trim(),title:parts.slice(1).join(' — ').trim()};
  const parts2=v.title.split(' - ');
  if(parts2.length>=2)return{artist:parts2[0].trim(),title:parts2.slice(1).join(' - ').trim()};
  return{artist:'',title:v.title};
}
// TV Overlay — 3 phase system
let ovTimers=[];let ovPhasesDone={now:false,next:false,just:false,xfade:false};
function resetOverlayPhases(){ovPhasesDone={now:false,next:false,just:false,xfade:false};ovTimers.forEach(t=>clearTimeout(t));ovTimers=[];hideOverlay()}
function showOverlay(phase,videoData,duration){
  const ov=document.getElementById('tvOverlay');
  const meta=parseVideoMeta(videoData);
  ov.className='tv-overlay phase-'+phase;
  document.getElementById('tvOvLabel').textContent=phase==='now'?'TAGAD SKAN':phase==='next'?'NĀKAMAIS':'TIKKO SKANĒJA';
  document.getElementById('tvOvTitle').textContent=meta.title;
  document.getElementById('tvOvArtist').textContent=meta.artist;
  document.getElementById('tvOvMeta').textContent='';
  // Show
  requestAnimationFrame(()=>{ov.classList.add('show')});
  // Auto-hide
  if(duration>0){const t=setTimeout(()=>{ov.classList.remove('show')},duration*1000);ovTimers.push(t)}
}
function hideOverlay(){const ov=document.getElementById('tvOverlay');if(ov)ov.classList.remove('show')}
function updateNowPlaying(){
  const ch=channels[currentChannel],v=ch.videos[currentVideoIdx[currentChannel]];
  document.getElementById('npText').textContent=v.title;
  document.getElementById('npCh').textContent='KAN '+(currentChannel+1)+' \u2014 '+ch.name;
  document.getElementById('npCh').style.color=ch.color;
  applyEraEffect(v.decade||'modern');
}
function applyEraEffect(decade){
  const s=document.getElementById('tvScreen');
  s.classList.remove('era-vintage','era-vcr','era-modern');
  s.classList.add(decade==='vintage'?'era-vintage':decade==='vcr'?'era-vcr':'era-modern');
}
function startProgressTracker(){
  if(progressInterval)clearInterval(progressInterval);
  progressInterval=setInterval(()=>{
    if(!playerReady||!isPoweredOn)return;
    if(isGameChannel(currentChannel))return; // Spēlei nav progress tracking
    try{
      const ap=activeSlot==='a'?playerA:playerB;
      const d=ap.getDuration(),c=ap.getCurrentTime();
      if(d<=0)return;
      const p=(c/d)*100+'%';document.getElementById('npProgressFill').style.width=p;
      const remaining=d-c;
      const v=channels[currentChannel].videos[currentVideoIdx[currentChannel]];
      // Phase 1: NOW PLAYING — pēc 15 sek. no sākuma, rāda 15 sek.
      if(c>=15&&c<30&&!ovPhasesDone.now){ovPhasesDone.now=true;showOverlay('now',v,15)}
      // Phase 2: UP NEXT — 30 sek. pirms beigām, rāda 15 sek. + preload nākamo
      if(remaining<=30&&remaining>15&&!ovPhasesDone.next){ovPhasesDone.next=true;showOverlay('next',getNextVideoInfo(),15);preloadNext()}
      // Phase 3: JUST PLAYED — 5 sek. pirms beigām, rāda 10 sek.
      if(remaining<=5&&remaining>0&&!ovPhasesDone.just){ovPhasesDone.just=true;showOverlay('just',v,10)}
      // Pre-fade: pēdējās 7 sek pakāpeniski samazina volume (100%→40%)
      if(remaining<=7&&remaining>4&&!crossfading&&!isMuted){
        const fadeProgress=(remaining-4)/3; // 1.0 pie 7s → 0.0 pie 4s
        const fadeVol=Math.round(currentVolume*(0.4+0.6*fadeProgress));
        try{ap.setVolume(fadeVol)}catch(e){}
      }
      // Crossfade: 4 sek pirms beigām sāk pāreju uz nākamo (4s paralēli abi skan)
      if(remaining<=4&&remaining>0&&!ovPhasesDone.xfade&&!crossfading){ovPhasesDone.xfade=true;nextVideo()}
    }catch(e){}
  },500);
}
document.getElementById('channelGrid').addEventListener('click',(e)=>{
  const btn=e.target.closest('.ch-btn');if(!btn||!isPoweredOn)return;
  const ch=parseInt(btn.dataset.ch);if(ch===currentChannel)return;switchChannel(ch);
});
function isGameChannel(ch){
  const c=channels[ch];if(!c)return false;
  return c._isGame||CHANNEL_CONFIG.find(cfg=>cfg.key===c.name&&cfg.type==='game');
}
function switchChannel(ch){
  if(ch<0||ch>=channels.length)return;
  // Ja iepriekšējais bija spēle — apstādināt
  if(isGameChannel(currentChannel)){stopGame()}
  currentChannel=ch;
  document.querySelectorAll('#channelGrid .ch-btn').forEach(b=>b.classList.toggle('active',parseInt(b.dataset.ch)===ch));
  const ov=document.getElementById('chOverlay');ov.textContent='KAN '+(ch+1);ov.classList.add('show');setTimeout(()=>ov.classList.remove('show'),1500);
  if(isGameChannel(ch)){
    // Spēles kanāls — pauzēt YouTube, startēt spēli
    try{const ap=activeSlot==='a'?playerA:playerB;if(ap)ap.pauseVideo()}catch(e){}
    showStatic(()=>{startGame()});
    return;
  }
  // Parastais YouTube kanāls
  const live=getLivePosition(ch);
  currentVideoIdx[ch]=live.videoIdx;
  showStatic(()=>{
    const v=channels[ch].videos[live.videoIdx];
    playVideoLive(v,live.seekTo);
  });
}
function changeChannel(dir){let n=currentChannel+dir;if(n<0)n=channels.length-1;if(n>=channels.length)n=0;switchChannel(n)}
function showStatic(cb){
  const el=document.getElementById('staticNoise'),canvas=document.getElementById('noiseCanvas'),ctx=canvas.getContext('2d');
  el.classList.add('show');canvas.width=400;canvas.height=300;let f=0;
  function draw(){const img=ctx.createImageData(canvas.width,canvas.height);for(let i=0;i<img.data.length;i+=4){const v=Math.random()*255;img.data[i]=v;img.data[i+1]=v;img.data[i+2]=v;img.data[i+3]=255}ctx.putImageData(img,0,0);f++;if(f<14)requestAnimationFrame(draw);else{el.classList.remove('show');if(cb)cb()}}
  draw();
}
function togglePower(){
  const btn=document.getElementById('powerBtnHorizontal'),off=document.getElementById('powerOff'),led=document.getElementById('ledPower'),bars=document.querySelectorAll('.indicator-bar'),pt=document.getElementById('powerText');
  if(isPoweredOn){
    isPoweredOn=false;btn.classList.remove('active');led.classList.add('off');
    if(typeof stopGame==='function'){try{stopGame()}catch(e){}}
    try{if(playerAReady)playerA.pauseVideo()}catch(e){}
    try{if(playerBReady)playerB.pauseVideo()}catch(e){}
    off.classList.add('show');const d=off.querySelector('.power-dot');d.style.animation='none';d.offsetHeight;d.style.animation='';bars.forEach((b,i)=>{if(i<3)b.classList.add('active');else b.classList.remove('active')});if(pt)pt.textContent='ON';
    setChatEnabled(false);
  }
  else{
    isPoweredOn=true;btn.classList.add('active');led.classList.remove('off');off.classList.remove('show');bars.forEach(b=>b.classList.add('active'));if(pt)pt.textContent='OFF';setChatEnabled(true);showStatic(()=>{
      const ap=activeSlot==='a'?playerA:playerB;
      if(playerReady&&ap)ap.playVideo();
    })}
}
function toggleMute(){
  const btn=document.getElementById('muteBtn');
  if(isMuted){isMuted=false;btn.classList.remove('active');setVolume(volumeBeforeMute);showMuteOSD(false)}
  else{volumeBeforeMute=currentVolume;isMuted=true;btn.classList.add('active');setVolume(0);showMuteOSD(true)}
  if(typeof gameAudio!=='undefined'&&gameAudio){gameAudio.muted=isMuted}
}
function toggleFullscreen(){
  if(!document.fullscreenElement){
    document.documentElement.requestFullscreen().catch(()=>{});
    document.getElementById('fullscreenBtn').classList.add('active');
    // Fullscreen: hide panel, screen fills everything
    document.querySelector('.tv-casing').classList.add('fs-mode');
  }
  else{
    document.exitFullscreen().catch(()=>{});
    document.getElementById('fullscreenBtn').classList.remove('active');
    document.querySelector('.tv-casing').classList.remove('fs-mode');
  }
}
document.addEventListener('fullscreenchange',()=>{
  if(!document.fullscreenElement){
    document.getElementById('fullscreenBtn').classList.remove('active');
    document.querySelector('.tv-casing').classList.remove('fs-mode');
  }
});
let volOsdTimer=null,muteOsdTimer=null;
function showVolOSD(val){
  const osd=document.getElementById('volOsd');
  const blocks=document.getElementById('volOsdBlocks');
  const dashes=document.getElementById('volOsdDashes');
  const valEl=document.getElementById('volOsdValue');
  if(!osd)return;
  // Build blocks + dashes
  const totalSegs=15;const filledSegs=Math.round(val/100*totalSegs);
  let bHTML='',dHTML='';
  for(let i=0;i<filledSegs;i++){const h=10+Math.round(i/totalSegs*18);bHTML+='<div class="vol-osd-block" style="height:'+h+'px"></div>'}
  for(let i=filledSegs;i<totalSegs;i++){dHTML+='<div class="vol-osd-dash"></div>'}
  blocks.innerHTML=bHTML;dashes.innerHTML=dHTML;
  valEl.textContent=val;
  osd.classList.add('show');
  clearTimeout(volOsdTimer);
  volOsdTimer=setTimeout(()=>osd.classList.remove('show'),1800);
}
function showMuteOSD(show){
  const osd=document.getElementById('muteOsd');if(!osd)return;
  clearTimeout(muteOsdTimer);muteOsdTimer=null;
  if(show){osd.classList.add('show')}
  else{osd.classList.remove('show')}
}
function setVolume(val){
  const prevVolume=currentVolume;
  if(val<0)val=0;if(val>100)val=100;
  currentVolume=val;
  const muteBtn=document.getElementById('muteBtn');
  if(val===0&&!isMuted){volumeBeforeMute=prevVolume||volumeBeforeMute;isMuted=true;if(muteBtn)muteBtn.classList.add('active');showMuteOSD(true)}
  else if(val>0&&isMuted){isMuted=false;if(muteBtn)muteBtn.classList.remove('active');showMuteOSD(false);volumeBeforeMute=val}
  if(playerReady)try{
    const ap=activeSlot==='a'?playerA:playerB;
    if(val===0){ap.mute()}else{ap.unMute();ap.setVolume(val)}
  }catch(e){}
  // Sync game audio volume
  if(typeof gameAudio!=='undefined'&&gameAudio){gameAudio.volume=val/100;gameAudio.muted=(val===0)}
  // sync circular knob
  const pct2=val/100;
  const arc=document.querySelector('.vc-arc'),glow=document.querySelector('.vc-glow');
  if(arc){arc.style.setProperty('--vc-pct',pct2);arc.style.strokeDasharray=(pct2*220)+' 220'}
  if(glow){glow.style.strokeDasharray=(pct2*220)+' 220'}
  const vcv=document.getElementById('vcVal');if(vcv)vcv.textContent=val;
  const vcd=document.getElementById('vcDot');if(vcd)vcd.style.rotate='calc(('+(pct2*252-126)+')*1deg)';
  const vci=document.getElementById('vcInput');if(vci&&parseInt(vci.value)!==val)vci.value=val;
  // Show volume OSD on screen
  showVolOSD(val);
}
function changeVolume(delta){
  if(isMuted&&delta>0){
    isMuted=false;
    const btn=document.getElementById('muteBtn');if(btn)btn.classList.remove('active');
    showMuteOSD(false);
    setVolume(volumeBeforeMute);
  }
  else{setVolume(currentVolume+delta)}
}
document.getElementById('vcInput').addEventListener('input',function(){
  const v=parseInt(this.value);
  setVolume(v);
});
// Initial volume set (will be applied on startTV)
setTimeout(()=>{setVolume(80)},400);
// SMS/Chat sistēma — viltotās ziņas pa 1/min, īstās uzreiz
const fakeSMS=[
  {name:'Jānis',text:'Sveiki visiem no Liepājas'},
  {name:'Kristīne',text:'Vai kāds atceras šo dziesmu'},
  {name:'Andris',text:'Palieliniet skaļumu'},
  {name:'Māra',text:'Kas par aukstu laiku šovakar'},
  {name:'Pēteris',text:'The Hobos bija brutāli'},
  {name:'Ilze',text:'Kur var nopirkt šo albumu'},
  {name:'Gatis',text:'Atceros šo dziesmu no bērnības'},
  {name:'Laura',text:'Piekrītu kur aizlīdām'},
  {name:'Roberts',text:'Pārslēdziet uz ROKS kanālu'},
  {name:'Inga',text:'Labvakar visiem'},
  {name:'Mārtiņš',text:'Vai te kāds ir no Ventspils'},
  {name:'Diāna',text:'Iesakiet labas dziesmas'},
  {name:'Edgars',text:'Prāta Vētra rulē'},
  {name:'Zane',text:'Sveiciens no Valmieras'},
  {name:'Aivars',text:'Agrāk TV bija labāks'},
  {name:'Elīna',text:'Kāds dzird no Jelgavas'},
  {name:'Kārlis',text:'Gribu vēl tādas dziesmas'},
  {name:'Dace',text:'Labākais kanāls šobrīd'},
  {name:'Raimonds',text:'Lūdzu vairāk retro'},
  {name:'Santa',text:'Kas ir šīs dziesmas autors'},
  {name:'Jēkabs',text:'Dzirdu pirmo reizi forši'},
  {name:'Agnese',text:'Šī bija mūsu izlaiduma dziesma'},
  {name:'Toms',text:'Vakar arī klausījos te'},
  {name:'Līga',text:'Mana mīļākā dziesma'},
  {name:'Oskars',text:'Šeit vienmēr laba mūzika'}
];
// Bad-words filtrs — ielādē no localStorage vai tukšs
let BAD_WORDS=[];
try{const bw=localStorage.getItem('lom_badwords');if(bw)BAD_WORDS=JSON.parse(bw)}catch(e){}
function filterBadWords(text){
  let c=text;
  BAD_WORDS.forEach(w=>{if(w.length<2)return;const re=new RegExp(w.replace(/[.*+?^${}()|[\]\\]/g,'\\$&'),'gi');c=c.replace(re,'\u2605'.repeat(Math.min(w.length,5)))});
  return c;
}
// Sanitizācija — tikai plain teksts, nekādu URL/email/kodu
function sanitizeChat(text){
  let s=text.replace(/<[^>]*>/g,''); // noņem HTML tagus
  s=s.replace(/https?:\/\/\S+/gi,''); // noņem URL ar http
  s=s.replace(/www\.\S+/gi,''); // noņem www.
  s=s.replace(/\S+\.(com|lv|org|net|io|eu|ru|de|uk|info|biz|me)\b/gi,''); // noņem domēnus
  s=s.replace(/\S+@\S+\.\S+/gi,''); // noņem email
  s=s.replace(/(\+?\d[\d\s\-]{6,})/g,''); // noņem tālruņu numurus (7+ cipari)
  s=s.replace(/[{}\[\]<>\\\/`]/g,''); // noņem koda simbolus
  s=s.replace(/\s+/g,' ').trim();
  return filterBadWords(s);
}
// smsMessages jau deklarēts augstāk (globālajā let blokā)
let smsTickerInterval=null;
let smsFakeIdx=0;
let smsStartTime=0;

function initSMS(){
  smsMessages=[];smsFakeIdx=0;smsStartTime=Date.now();
  // Sākotnēji pievienot 3 ziņas lai ticker nav tukšs
  for(let i=0;i<3;i++){smsMessages.push(fakeSMS[smsFakeIdx%fakeSMS.length]);smsFakeIdx++}
  renderTicker();
  // Ik 60 sek pievienot jaunu viltotu ziņu
  if(smsTickerInterval)clearInterval(smsTickerInterval);
  smsTickerInterval=setInterval(()=>{
    smsMessages.push(fakeSMS[smsFakeIdx%fakeSMS.length]);smsFakeIdx++;
    // Noņemt vecākās ja par daudz (max 20 redzamas)
    if(smsMessages.length>20)smsMessages.shift();
    renderTicker();
  },60000);
  const n=document.getElementById('smsName'),t=document.getElementById('smsText');
  if(n&&t){n.addEventListener('input',checkSMSForm);t.addEventListener('input',checkSMSForm);checkSMSForm()}
}
function renderTicker(){
  const t=document.getElementById('smsTicker');let h='';
  for(let r=0;r<2;r++)smsMessages.forEach(m=>{h+='<span class="sms-item"><span class="sms-name">'+m.name+':</span> <span class="sms-text">'+m.text+'</span><span class="sms-sep">★</span></span>'});
  t.innerHTML=h;t.style.animationDuration=Math.max(40,t.scrollWidth/2/35)+'s';
}
function checkSMSForm(){
  const n=document.getElementById('smsName'),t=document.getElementById('smsText'),btn=document.getElementById('smsSendBtn');
  if(n.value.trim()&&t.value.trim()){btn.classList.add('active')}
  else{btn.classList.remove('active')}
}
function sendSMS(){
  if(!isPoweredOn)return;
  const n=document.getElementById('smsName'),t=document.getElementById('smsText');
  if(!n.value.trim()||!t.value.trim())return;
  const cleanName=sanitizeChat(n.value.trim()).substring(0,15);
  const cleanText=sanitizeChat(t.value.trim()).substring(0,280);
  if(!cleanName||!cleanText)return;
  const msg={name:cleanName,text:cleanText,ts:Date.now(),real:true};
  smsMessages.push(msg);renderTicker();
  // Saglabāt localStorage
  try{
    let stored=JSON.parse(localStorage.getItem('lom_chat')||'[]');
    stored.push(msg);
    // Noņemt vecākos par 1h
    const cutoff=Date.now()-3600000;
    stored=stored.filter(m=>m.ts>cutoff);
    localStorage.setItem('lom_chat',JSON.stringify(stored));
  }catch(e){}
  // Pirmajās 2 minūtēs — atkārtot pēc 30 sek
  const elapsed=Date.now()-smsStartTime;
  if(elapsed<120000){setTimeout(()=>{smsMessages.push(msg);renderTicker()},30000)}
  n.value='';t.value='';checkSMSForm();
}
function shareApp(){const u=location.href;if(navigator.share)navigator.share({title:'LOM TV',text:'LOM TV — Latvijas Online Mūzika 📺🇱🇻',url:u}).catch(()=>{});else navigator.clipboard.writeText(u).catch(()=>{})}
// Click on screen = toggle mute
document.getElementById('tvScreen').addEventListener('click',(e)=>{
  if(!isPoweredOn)return;
  if(e.target.closest('.screen-logo')||e.target.closest('.now-playing')||e.target.closest('.fs-exit-btn'))return;
  toggleMute();
});
document.addEventListener('keydown',(e)=>{
  if(e.target.tagName==='INPUT')return;
  if(e.key==='Enter'&&(e.target.id==='smsName'||e.target.id==='smsText')){if(document.getElementById('smsSendBtn').classList.contains('active'))sendSMS();return}
  const n=parseInt(e.key);if(n>=1&&n<=9&&n<=channels.length)switchChannel(n-1);if(e.key==='0'&&channels.length>=10)switchChannel(9);
  if(e.key==='ArrowUp'){e.preventDefault();changeChannel(-1)}if(e.key==='ArrowDown'){e.preventDefault();changeChannel(1)}
  if(e.key==='ArrowLeft'){e.preventDefault();changeVolume(-5)}if(e.key==='ArrowRight'){e.preventDefault();changeVolume(5)}
  if(e.key==='n'||e.key==='N')nextVideo();if(e.key==='p'||e.key==='P')togglePower();if(e.key==='f'||e.key==='F')toggleFullscreen();if(e.key==='Escape'&&document.fullscreenElement)document.exitFullscreen();
});
function setChatEnabled(on){
  const ticker=document.querySelector('.sms-ticker-screen');if(ticker)ticker.classList.toggle('off',!on);
  const panel=document.getElementById('smsPanel');if(panel)panel.classList.toggle('disabled',!on);
  const name=document.getElementById('smsName'),text=document.getElementById('smsText'),btn=document.getElementById('smsSendBtn');
  [name,text,btn].forEach(el=>{if(el)el.disabled=!on});
}
// ====== SYNTHWAVE GAME ENGINE ======
const GAME_TRACKS=[
  'https://cdn.pixabay.com/audio/2022/10/25/audio_33f0f26cfa.mp3',
  'https://cdn.pixabay.com/audio/2022/05/27/audio_1808fbf07a.mp3',
  'https://cdn.pixabay.com/audio/2023/07/06/audio_e4d5a58e66.mp3'
];
let gameAudio=new Audio();
gameAudio.loop=true;gameAudio.volume=0.5;
let gameRunning=false,gameScore=0,gameCarLane=1,gameLoop=null,gameSpeed=2,gameLastSpawn=0;
let gameTouchStartX=0;

function generateStars(){
  const c=document.getElementById('swStars');if(!c)return;
  c.innerHTML='';
  for(let i=0;i<60;i++){
    const s=document.createElement('div');s.className='sw-star';
    s.style.left=Math.random()*100+'%';
    s.style.top=Math.random()*55+'%';
    s.style.width=(1+Math.random()*2)+'px';
    s.style.height=s.style.width;
    s.style.animationDelay=Math.random()*3+'s';
    s.style.animationDuration=(2+Math.random()*3)+'s';
    if(Math.random()>0.6)s.style.background='rgba(155,77,255,0.7)';
    c.appendChild(s);
  }
}

function startGame(){
  gameRunning=true;gameScore=0;gameCarLane=1;gameSpeed=2;gameLastSpawn=0;
  const gs=document.getElementById('game-slot');
  if(gs)gs.style.display='block';
  // Paslēpt YouTube slotus
  document.getElementById('yt-slot-a').classList.add('yt-hidden');
  document.getElementById('yt-slot-b').classList.add('yt-hidden');
  // Ģenerēt zvaigznes
  generateStars();
  // Notīrīt vecos obstacles
  const ob=document.getElementById('swObstacles');if(ob)ob.innerHTML='';
  // Auto pozīcija — centrs
  updateCarPosition();
  // Score
  const sc=document.getElementById('swScore');if(sc)sc.textContent='0';
  // Audio
  startGameAudio();
  // Game loop
  gameLoop=requestAnimationFrame(gameTick);
}

function stopGame(){
  gameRunning=false;
  if(gameLoop){cancelAnimationFrame(gameLoop);gameLoop=null}
  const gs=document.getElementById('game-slot');
  if(gs)gs.style.display='none';
  // Atkal rādīt aktīvo YouTube slotu
  document.getElementById('yt-slot-'+activeSlot).classList.remove('yt-hidden');
  stopGameAudio();
}

function startGameAudio(){
  try{
    gameAudio.src=GAME_TRACKS[Math.floor(Math.random()*GAME_TRACKS.length)];
    gameAudio.volume=isMuted?0:currentVolume/100;
    gameAudio.play().catch(()=>{});
  }catch(e){}
}
function stopGameAudio(){try{gameAudio.pause();gameAudio.currentTime=0}catch(e){}}

let lastGameTime=0;
function gameTick(ts){
  if(!gameRunning)return;
  // Delta time ~60fps
  if(!lastGameTime)lastGameTime=ts;
  const dt=Math.min(ts-lastGameTime,50);
  lastGameTime=ts;
  // Score +1 katru frame (~60/sek)
  gameScore++;
  gameSpeed=2+Math.floor(gameScore/800)*0.3;
  // Spawn obstacles
  const spawnRate=Math.max(45,110-Math.floor(gameScore/150));
  if(gameScore-gameLastSpawn>=spawnRate){
    gameLastSpawn=gameScore;
    spawnObstacle();
  }
  // Move obstacles
  moveObstacles();
  // Update score display
  if(gameScore%3===0){const sc=document.getElementById('swScore');if(sc)sc.textContent=gameScore}
  // Bonus!
  if(gameScore>0&&gameScore%500===0){showGameBonus()}
  gameLoop=requestAnimationFrame(gameTick);
}

function spawnObstacle(){
  const container=document.getElementById('swObstacles');if(!container)return;
  const lane=Math.floor(Math.random()*3); // 0,1,2
  const types=['palm','building','mountain'];
  const type=types[Math.floor(Math.random()*types.length)];
  const el=document.createElement('div');
  el.className='sw-obstacle sw-'+type;
  el.dataset.lane=lane;
  el.dataset.y=0; // progress 0..110
  // Lane X positions (% of container width)
  const laneX=[20,50,80];
  el.style.left=laneX[lane]+'%';
  el.style.transform='translateX(-50%) translateY(0px) scale(0.3)';
  el.style.top='35%'; // horizon
  // Size by type
  if(type==='palm'){el.style.width='30px';el.style.height='50px';
    el.innerHTML='<div class="sw-palm-trunk"></div><div class="sw-palm-top"></div>'}
  else if(type==='building'){el.style.width=(15+Math.random()*20)+'px';el.style.height=(30+Math.random()*40)+'px'}
  else{el.style.width=(40+Math.random()*30)+'px';el.style.height=(25+Math.random()*20)+'px'}
  container.appendChild(el);
}

function moveObstacles(){
  const container=document.getElementById('swObstacles');if(!container)return;
  const obstacles=container.children;
  const toRemove=[];
  for(let i=0;i<obstacles.length;i++){
    const el=obstacles[i];
    let y=parseFloat(el.dataset.y)||0;
    y+=gameSpeed*0.8;
    el.dataset.y=y;
    // Perspective: starts at horizon (35% top), moves to bottom, scaling up
    const progress=Math.min(y/100,1.1);
    const topPct=35+progress*60; // 35% → 95%
    const scale=0.3+progress*1.2; // 0.3 → 1.5
    const laneX=[20,50,80];
    const lane=parseInt(el.dataset.lane);
    // Lanes spread apart as they come closer
    const spread=1+progress*0.8;
    const centerX=50;
    const laneOffset=(laneX[lane]-centerX)*spread+centerX;
    el.style.top=topPct+'%';
    el.style.left=laneOffset+'%';
    el.style.transform='translateX(-50%) scale('+scale.toFixed(2)+')';
    el.style.opacity=Math.min(1,progress*2);
    // Collision check — if obstacle is at car position (progress ~0.85-1.0) and same lane
    if(progress>0.82&&progress<0.98&&lane===gameCarLane){
      // Hit! Flash car, but keep going
      const car=document.getElementById('swCar');
      if(car&&!car.classList.contains('hit')){
        car.classList.add('hit');
        setTimeout(()=>car.classList.remove('hit'),400);
      }
    }
    if(y>120)toRemove.push(el);
  }
  toRemove.forEach(el=>el.remove());
}

function updateCarPosition(){
  const car=document.getElementById('swCar');if(!car)return;
  const laneX=[22,50,78]; // % positions for 3 lanes
  car.style.left=laneX[gameCarLane]+'%';
  car.style.transform='translateX(-50%)';
}

function showGameBonus(){
  const scene=document.querySelector('.sw-scene');if(!scene)return;
  const b=document.createElement('div');b.className='sw-bonus';b.textContent='+'+gameScore;
  scene.appendChild(b);
  setTimeout(()=>b.remove(),900);
}

// Keyboard controls
document.addEventListener('keydown',function(e){
  if(!gameRunning)return;
  if(e.key==='ArrowLeft'&&gameCarLane>0){gameCarLane--;updateCarPosition();e.preventDefault()}
  if(e.key==='ArrowRight'&&gameCarLane<2){gameCarLane++;updateCarPosition();e.preventDefault()}
});
// Touch controls
document.addEventListener('DOMContentLoaded',function(){
  const tl=document.getElementById('swTouchL'),tr=document.getElementById('swTouchR');
  if(tl)tl.addEventListener('touchstart',function(e){if(!gameRunning)return;e.preventDefault();if(gameCarLane>0){gameCarLane--;updateCarPosition()}},{passive:false});
  if(tr)tr.addEventListener('touchstart',function(e){if(!gameRunning)return;e.preventDefault();if(gameCarLane<2){gameCarLane++;updateCarPosition()}},{passive:false});
});

// ====== INFO POPUP ENHANCEMENTS ======
// Text highlight on scroll (IntersectionObserver)
function initTextHighlights(){
  const body=document.getElementById('infoBody');
  const highlights=document.querySelectorAll('#infoBody .text-highlight');
  if(!body||!highlights.length)return;
  // Reset highlights
  highlights.forEach(h=>h.classList.remove('active'));
  const observer=new IntersectionObserver((entries)=>{
    entries.forEach(e=>{if(e.isIntersecting)e.target.classList.add('active')});
  },{root:body,threshold:0.5});
  highlights.forEach(h=>observer.observe(h));
  return observer;
}
// Progress bar on popup scroll
function initInfoProgress(){
  const body=document.getElementById('infoBody');
  const fill=document.getElementById('infoProgressFill');
  if(!body||!fill)return;
  body.addEventListener('scroll',function(){
    const scrollTop=body.scrollTop;
    const scrollHeight=body.scrollHeight-body.clientHeight;
    const pct=scrollHeight>0?Math.round(scrollTop/scrollHeight*100):0;
    fill.style.width=pct+'%';
  });
}
// Magic stars animation on popup title
function initMagicStars(){
  const title=document.getElementById('infoTitle');
  if(!title)return;
  const stars=title.querySelectorAll('.magic-star');
  const rand=(min,max)=>Math.floor(Math.random()*(max-min+1))+min;
  let idx=0;
  function animateStar(star){
    star.style.setProperty('--star-left',rand(-10,110)+'%');
    star.style.setProperty('--star-top',rand(-60,80)+'%');
    star.style.animation='none';star.offsetHeight;star.style.animation='';
  }
  stars.forEach(star=>{
    setTimeout(()=>{animateStar(star);setInterval(()=>animateStar(star),1000)},idx++*333);
  });
}
// Info popup with text highlights, progress bar, magic stars
let infoHighlightObserver=null;
function toggleInfoPopup(){
  const ov=document.getElementById('infoOverlay');
  ov.classList.toggle('show');
  if(ov.classList.contains('show')){
    setTimeout(()=>{
      infoHighlightObserver=initTextHighlights();
      initInfoProgress();
      initMagicStars();
    },100);
  }else{
    if(infoHighlightObserver){infoHighlightObserver.disconnect();infoHighlightObserver=null}
  }
}

// ADMIN MODERĀCIJAS PANELIS — ?admin=1
(function(){
  if(!new URLSearchParams(location.search).has('admin'))return;
  const css=document.createElement('style');
  css.textContent=`
    .admin-panel{position:fixed;top:0;right:0;width:380px;max-height:100vh;overflow-y:auto;z-index:9999;
      background:rgba(10,10,20,0.96);border-left:2px solid var(--neon-purple);padding:16px;font-family:var(--font-main);font-size:14px;color:#ccc}
    .admin-panel h3{color:var(--neon-purple);margin-bottom:12px;font-size:18px}
    .admin-msg{display:flex;align-items:center;gap:8px;padding:6px 0;border-bottom:1px solid rgba(255,255,255,0.08)}
    .admin-msg-text{flex:1;word-break:break-word}
    .admin-msg-name{color:var(--electric-blue);font-weight:700}
    .admin-msg-time{color:rgba(255,255,255,0.3);font-size:11px;flex-shrink:0}
    .admin-del{background:#ff4444;color:#fff;border:none;border-radius:4px;padding:2px 8px;cursor:pointer;font-size:12px;flex-shrink:0}
    .admin-del:hover{background:#ff6666}
    .admin-section{margin-top:16px;padding-top:12px;border-top:1px solid rgba(255,255,255,0.15)}
    .admin-section h4{color:var(--electric-blue);margin-bottom:8px}
    .admin-textarea{width:100%;height:80px;background:#1a1a2a;color:#ccc;border:1px solid rgba(155,77,255,0.3);border-radius:6px;padding:8px;font-size:13px;resize:vertical}
    .admin-btn{background:var(--neon-purple);color:#fff;border:none;border-radius:6px;padding:8px 16px;cursor:pointer;font-size:13px;margin-top:6px}
    .admin-btn:hover{opacity:0.85}
    .admin-close{position:absolute;top:8px;right:12px;background:none;border:none;color:#fff;font-size:24px;cursor:pointer}
  `;
  document.head.appendChild(css);
  const panel=document.createElement('div');
  panel.className='admin-panel';
  panel.id='adminPanel';
  panel.innerHTML=`
    <button class="admin-close" onclick="document.getElementById('adminPanel').style.display='none'">&times;</button>
    <h3>Cata moderacija</h3>
    <div id="adminMsgList"><em>Nav zinu</em></div>
    <div class="admin-section">
      <h4>Aizliegto vardu saraksts</h4>
      <textarea class="admin-textarea" id="adminBadWords" placeholder="Viens vards per rindinu..."></textarea>
      <button class="admin-btn" onclick="saveBadWords()">Saglabat vardus</button>
      <input type="file" id="adminBadFile" accept=".txt" style="margin-top:6px;color:#ccc" onchange="loadBadFile(event)">
    </div>
  `;
  document.body.appendChild(panel);
  // Ielādēt bad words textarea
  try{const bw=localStorage.getItem('lom_badwords');if(bw){document.getElementById('adminBadWords').value=JSON.parse(bw).join('\n')}}catch(e){}
  // Atjaunot ziņu sarakstu
  function refreshAdmin(){
    const list=document.getElementById('adminMsgList');
    let stored=[];
    try{stored=JSON.parse(localStorage.getItem('lom_chat')||'[]')}catch(e){}
    const cutoff=Date.now()-3600000;
    stored=stored.filter(m=>m.ts>cutoff);
    if(stored.length===0){list.innerHTML='<em>Nav zinu pedeja 1h</em>';return}
    let h='';
    stored.forEach((m,i)=>{
      const t=new Date(m.ts);const time=t.getHours().toString().padStart(2,'0')+':'+t.getMinutes().toString().padStart(2,'0');
      h+=`<div class="admin-msg"><span class="admin-msg-time">${time}</span><span class="admin-msg-name">${m.name}:</span><span class="admin-msg-text">${m.text}</span><button class="admin-del" onclick="adminDeleteMsg(${i})">X</button></div>`;
    });
    list.innerHTML=h;
  }
  refreshAdmin();
  setInterval(refreshAdmin,10000);
  window.adminDeleteMsg=function(idx){
    try{
      let stored=JSON.parse(localStorage.getItem('lom_chat')||'[]');
      const cutoff=Date.now()-3600000;
      stored=stored.filter(m=>m.ts>cutoff);
      stored.splice(idx,1);
      localStorage.setItem('lom_chat',JSON.stringify(stored));
      refreshAdmin();
    }catch(e){}
  };
  window.saveBadWords=function(){
    const words=document.getElementById('adminBadWords').value.split('\n').map(w=>w.trim()).filter(w=>w.length>1);
    BAD_WORDS=words;
    localStorage.setItem('lom_badwords',JSON.stringify(words));
    alert('Saglabati '+words.length+' vardi');
  };
  window.loadBadFile=function(e){
    const file=e.target.files[0];if(!file)return;
    const reader=new FileReader();
    reader.onload=function(ev){
      document.getElementById('adminBadWords').value=ev.target.result;
      saveBadWords();
    };
    reader.readAsText(file);
  };
})();
</script>
</body>
</html>
